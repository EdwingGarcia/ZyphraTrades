<Window x:Class="ZyphraTrades.Presentation.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:ZyphraTrades.Presentation.Converters"
        xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
        xmlns:lvs="clr-namespace:LiveChartsCore.SkiaSharpView;assembly=LiveChartsCore.SkiaSharpView"
        Title="ZyphraTrades"
        Height="860"
        Width="1420"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource ThemeBg0B}"
        Foreground="{DynamicResource ThemeFgB}">

    <Window.Resources>
        <conv:PageToVisibilityConverter   x:Key="PageVis"/>
        <conv:PnlToBrushConverter         x:Key="PnlBrush"/>
        <conv:PnlToBorderBrushConverter   x:Key="PnlBorder"/>
        <conv:SideToBrushConverter        x:Key="SideBrush"/>
        <conv:RatingToStarsConverter      x:Key="Stars"/>
        <conv:NullToVisibilityConverter   x:Key="NullVis"/>
        <conv:CategoryToBrushConverter    x:Key="CatBrush"/>
        <conv:BoolToVisibilityConverter   x:Key="BoolVis"/>
        <conv:InverseBoolToVisibilityConverter x:Key="BoolVisInv"/>
        <conv:InverseBoolConverter        x:Key="BoolInvert"/>
        <conv:EnumToSpanishConverter      x:Key="EnumEs"/>

        <!-- Fuente condensada global -->
        <Style TargetType="TextBlock">
            <Setter Property="FontFamily"
                    Value="Segoe UI"/>
            <Setter Property="FontSize"
                    Value="12"/>
        </Style>

        <!--  CARD  -->
        <Style x:Key="Card"
               TargetType="Border">
            <Setter Property="Background"
                    Value="{DynamicResource ThemeBg1B}"/>
            <Setter Property="BorderBrush"
                    Value="{DynamicResource ThemeStrokeB}"/>
            <Setter Property="BorderThickness"
                    Value="1"/>
            <Setter Property="CornerRadius"
                    Value="12"/>
            <Setter Property="Padding"
                    Value="16"/>
            <Setter Property="SnapsToDevicePixels"
                    Value="True"/>
        </Style>

        <!--  DASHBOARD KPI CARD (wine accent)  -->
        <Style x:Key="DashCard"
               TargetType="Border">
            <Setter Property="Background"
                    Value="{DynamicResource ThemeBg1B}"/>
            <Setter Property="BorderBrush"
                    Value="{DynamicResource ThemeCyanB}"/>
            <Setter Property="BorderThickness"
                    Value="1"/>
            <Setter Property="CornerRadius"
                    Value="12"/>
            <Setter Property="Padding"
                    Value="16"/>
            <Setter Property="SnapsToDevicePixels"
                    Value="True"/>
        </Style>

        <!--  PRIMARY BUTTON  -->
        <Style x:Key="BtnPrimary"
               TargetType="Button">
            <Setter Property="Padding"
                    Value="16,8"/>
            <Setter Property="FontSize"
                    Value="12"/>
            <Setter Property="FontWeight"
                    Value="SemiBold"/>
            <Setter Property="Cursor"
                    Value="Hand"/>
            <Setter Property="Foreground"
                    Value="#FFFFFF"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}"
                                Background="{DynamicResource ThemeAccentB}"
                                SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="{DynamicResource ThemeAccentHoverB}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled"
                                     Value="False">
                                <Setter Property="Opacity"
                                        Value="0.35"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  GHOST BUTTON  -->
        <Style x:Key="BtnGhost"
               TargetType="Button">
            <Setter Property="Padding"
                    Value="12,7"/>
            <Setter Property="FontSize"
                    Value="12"/>
            <Setter Property="FontWeight"
                    Value="SemiBold"/>
            <Setter Property="Cursor"
                    Value="Hand"/>
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeFgSecondaryB}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}"
                                Background="{DynamicResource ThemeBg2B}"
                                BorderBrush="{DynamicResource ThemeStrokeB}"
                                BorderThickness="1"
                                SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="{DynamicResource ThemeBg3B}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled"
                                     Value="False">
                                <Setter Property="Opacity"
                                        Value="0.30"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  ACCORDION BUTTON  -->
        <Style x:Key="BtnAccordion"
               TargetType="Button">
            <Setter Property="Padding"
                    Value="14,10"/>
            <Setter Property="FontSize"
                    Value="13"/>
            <Setter Property="FontWeight"
                    Value="SemiBold"/>
            <Setter Property="Cursor"
                    Value="Hand"/>
            <Setter Property="HorizontalContentAlignment"
                    Value="Left"/>
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeFgB}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}"
                                Background="{DynamicResource ThemeBg2B}"
                                BorderBrush="{DynamicResource ThemeStrokeB}"
                                BorderThickness="1"
                                SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="{DynamicResource ThemeBg3B}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  NAV ITEM  -->
        <Style x:Key="NavItem"
               TargetType="Button">
            <Setter Property="HorizontalContentAlignment"
                    Value="Left"/>
            <Setter Property="Padding"
                    Value="12,10"/>
            <Setter Property="Margin"
                    Value="0,2"/>
            <Setter Property="FontSize"
                    Value="13"/>
            <Setter Property="Cursor"
                    Value="Hand"/>
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeMutedB}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}"
                                Background="Transparent"
                                SnapsToDevicePixels="True">
                            <ContentPresenter VerticalAlignment="Center"
                                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="{DynamicResource ThemeBg2B}"/>
                                <Setter Property="Foreground"
                                        Value="{DynamicResource ThemeFgB}"/>
                            </Trigger>
                            <Trigger Property="Tag"
                                     Value="Active">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="{DynamicResource ThemeBg2B}"/>
                                <Setter Property="Foreground"
                                        Value="{DynamicResource ThemeFgB}"/>
                                <Setter Property="FontWeight"
                                        Value="SemiBold"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  TEXTBOX  -->
        <Style TargetType="TextBox">
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeFgB}"/>
            <Setter Property="CaretBrush"
                    Value="{DynamicResource ThemeCyanB}"/>
            <Setter Property="SelectionBrush"
                    Value="{DynamicResource ThemeAccentB}"/>
            <Setter Property="FontSize"
                    Value="12"/>
            <Setter Property="SnapsToDevicePixels"
                    Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="Bd"
                                Background="{DynamicResource ThemeBg0B}"
                                BorderBrush="{DynamicResource ThemeStrokeB}"
                                BorderThickness="1"
                                CornerRadius="6"
                                Padding="8,7"
                                SnapsToDevicePixels="True">
                            <ScrollViewer x:Name="PART_ContentHost"
                                          Focusable="False"
                                          HorizontalScrollBarVisibility="Hidden"
                                          VerticalScrollBarVisibility="Hidden"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="BorderBrush"
                                        Value="{DynamicResource ThemeStrokeLightB}"/>
                            </Trigger>
                            <Trigger Property="IsFocused"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="BorderBrush"
                                        Value="{DynamicResource ThemeCyanB}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled"
                                     Value="False">
                                <Setter Property="Opacity"
                                        Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  COMBOBOX  -->
        <ControlTemplate x:Key="ComboBoxToggleButton"
                         TargetType="ToggleButton">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="28"/>
                </Grid.ColumnDefinitions>
                <Border x:Name="Bd"
                        Grid.ColumnSpan="2"
                        Background="{DynamicResource ThemeBg0B}"
                        BorderBrush="{DynamicResource ThemeStrokeB}"
                        BorderThickness="1"
                        CornerRadius="6"
                        SnapsToDevicePixels="True"/>
                <Border Grid.Column="0"
                        Background="Transparent"
                        CornerRadius="6,0,0,6"
                        Margin="1"/>
                <Path x:Name="Arrow"
                      Grid.Column="1"
                      Data="M 0 0 L 4 4 L 8 0 Z"
                      Fill="{DynamicResource ThemeMutedB}"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"/>
            </Grid>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver"
                         Value="True">
                    <Setter TargetName="Bd"
                            Property="BorderBrush"
                            Value="{DynamicResource ThemeStrokeLightB}"/>
                </Trigger>
                <Trigger Property="IsChecked"
                         Value="True">
                    <Setter TargetName="Bd"
                            Property="BorderBrush"
                            Value="{DynamicResource ThemeCyanB}"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
        <ControlTemplate x:Key="ComboBoxTextBox"
                         TargetType="TextBox">
            <Border x:Name="PART_ContentHost"
                    Focusable="False"
                    Background="Transparent"/>
        </ControlTemplate>
        <Style TargetType="ComboBox">
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeFgB}"/>
            <Setter Property="FontSize"
                    Value="12"/>
            <Setter Property="SnapsToDevicePixels"
                    Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton x:Name="ToggleButton"
                                          Template="{StaticResource ComboBoxToggleButton}"
                                          Focusable="False"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press"/>
                            <ContentPresenter x:Name="ContentSite"
                                              IsHitTestVisible="False"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                              Margin="8,6,28,6"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Left"/>
                            <TextBox x:Name="PART_EditableTextBox"
                                     Template="{StaticResource ComboBoxTextBox}"
                                     HorizontalAlignment="Left"
                                     VerticalAlignment="Center"
                                     Margin="8,6,28,6"
                                     Focusable="True"
                                     Background="Transparent"
                                     Foreground="{DynamicResource ThemeFgB}"
                                     CaretBrush="{DynamicResource ThemeCyanB}"
                                     Visibility="Hidden"
                                     IsReadOnly="{TemplateBinding IsReadOnly}"/>
                            <Popup x:Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Grid x:Name="DropDown"
                                      SnapsToDevicePixels="True"
                                      MinWidth="{TemplateBinding ActualWidth}"
                                      MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border x:Name="DropDownBorder"
                                            Background="{DynamicResource ThemeBg1B}"
                                            BorderBrush="{DynamicResource ThemeStrokeLightB}"
                                            BorderThickness="1"
                                            CornerRadius="6"
                                            Margin="0,2,0,0"/>
                                    <ScrollViewer Margin="4,6"
                                                  SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True"
                                                    KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Grid>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="HasItems"
                                     Value="False">
                                <Setter TargetName="DropDownBorder"
                                        Property="MinHeight"
                                        Value="95"/>
                            </Trigger>
                            <Trigger Property="IsEditable"
                                     Value="True">
                                <Setter Property="IsTabStop"
                                        Value="False"/>
                                <Setter TargetName="PART_EditableTextBox"
                                        Property="Visibility"
                                        Value="Visible"/>
                                <Setter TargetName="ContentSite"
                                        Property="Visibility"
                                        Value="Hidden"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="ComboBoxItem">
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeFgSecondaryB}"/>
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="Padding"
                    Value="8,6"/>
            <Setter Property="FontSize"
                    Value="12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBoxItem">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="4"
                                Margin="2,1">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="{DynamicResource ThemeBg2B}"/>
                            </Trigger>
                            <Trigger Property="IsSelected"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="{DynamicResource ThemeBg3B}"/>
                                <Setter Property="Foreground"
                                        Value="{DynamicResource ThemeFgB}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  DATEPICKER  -->
        <Style TargetType="DatePickerTextBox">
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeFgB}"/>
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DatePickerTextBox">
                        <ScrollViewer x:Name="PART_ContentHost"
                                      Focusable="False"
                                      HorizontalScrollBarVisibility="Hidden"
                                      VerticalScrollBarVisibility="Hidden"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="DatePicker">
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeFgB}"/>
            <Setter Property="FontSize"
                    Value="12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DatePicker">
                        <Border x:Name="Bd"
                                Background="{DynamicResource ThemeBg0B}"
                                BorderBrush="{DynamicResource ThemeStrokeB}"
                                BorderThickness="1"
                                CornerRadius="6"
                                Padding="8,6"
                                SnapsToDevicePixels="True">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <DatePickerTextBox x:Name="PART_TextBox"
                                                   Foreground="{DynamicResource ThemeFgB}"
                                                   VerticalAlignment="Center"
                                                   HorizontalAlignment="Stretch"/>
                                <Button x:Name="PART_Button"
                                        Grid.Column="1"
                                        Foreground="{DynamicResource ThemeMutedB}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Padding="4,0,0,0"
                                        Cursor="Hand"
                                        VerticalAlignment="Center">
                                    <Path Data="M 0,0 H12 V12 H0 Z M 0,3 H12 M 3,0 V3 M 9,0 V3"
                                          Stroke="{DynamicResource ThemeMutedB}"
                                          StrokeThickness="1.2"
                                          Width="14"
                                          Height="14"/>
                                </Button>
                                <Popup x:Name="PART_Popup"
                                       PlacementTarget="{Binding ElementName=Bd}"
                                       Placement="Bottom"
                                       AllowsTransparency="True"
                                       StaysOpen="False">
                                    <Border Background="{DynamicResource ThemeBg1B}"
                                            BorderBrush="{DynamicResource ThemeStrokeLightB}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="4"
                                            Margin="0,2,0,0">
                                        <Calendar x:Name="PART_Calendar"/>
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="BorderBrush"
                                        Value="{DynamicResource ThemeStrokeLightB}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  CHECKBOX  -->
        <Style TargetType="CheckBox">
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeFgSecondaryB}"/>
            <Setter Property="FontSize"
                    Value="12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <StackPanel Orientation="Horizontal">
                            <Border x:Name="Box"
                                    Width="18"
                                    Height="18"
                                    CornerRadius="4"
                                    Background="{DynamicResource ThemeBg0B}"
                                    BorderBrush="{DynamicResource ThemeStrokeB}"
                                    BorderThickness="1.5"
                                    SnapsToDevicePixels="True">
                                <Path x:Name="Check"
                                      Data="M 3,8 L 7,12 L 13,4"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      Visibility="Collapsed"
                                      Margin="-1,-1,0,0"/>
                            </Border>
                            <ContentPresenter Margin="6,0,0,0"
                                              VerticalAlignment="Center"/>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked"
                                     Value="True">
                                <Setter TargetName="Box"
                                        Property="Background"
                                        Value="{DynamicResource ThemeAccentB}"/>
                                <Setter TargetName="Box"
                                        Property="BorderBrush"
                                        Value="{DynamicResource ThemeAccentB}"/>
                                <Setter TargetName="Check"
                                        Property="Visibility"
                                        Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Box"
                                        Property="BorderBrush"
                                        Value="{DynamicResource ThemeStrokeLightB}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  LISTBOX  -->
        <Style TargetType="ListBox">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="BorderThickness"
                    Value="0"/>
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeFgB}"/>
        </Style>
        <Style TargetType="ListBoxItem">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeFgB}"/>
            <Setter Property="Padding"
                    Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="{DynamicResource ThemeBg2B}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  SCROLLBAR  -->
        <Style x:Key="ScrollBarThumb"
               TargetType="Thumb">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Thumb">
                        <Border Background="{DynamicResource ThemeBg3B}"
                                CornerRadius="4"
                                Margin="1"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="ScrollBarPageButton"
               TargetType="RepeatButton">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RepeatButton">
                        <Border Background="Transparent"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="ScrollBar">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="Width"
                    Value="8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid Background="Transparent">
                            <Track x:Name="PART_Track"
                                   IsDirectionReversed="True">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Style="{StaticResource ScrollBarPageButton}"
                                                  Command="ScrollBar.PageUpCommand"/>
                                </Track.DecreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb Style="{StaticResource ScrollBarThumb}"/>
                                </Track.Thumb>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Style="{StaticResource ScrollBarPageButton}"
                                                  Command="ScrollBar.PageDownCommand"/>
                                </Track.IncreaseRepeatButton>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="Orientation"
                         Value="Horizontal">
                    <Setter Property="Height"
                            Value="8"/>
                    <Setter Property="Width"
                            Value="Auto"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ScrollBar">
                                <Grid Background="Transparent">
                                    <Track x:Name="PART_Track"
                                           IsDirectionReversed="False">
                                        <Track.DecreaseRepeatButton>
                                            <RepeatButton Style="{StaticResource ScrollBarPageButton}"
                                                          Command="ScrollBar.PageLeftCommand"/>
                                        </Track.DecreaseRepeatButton>
                                        <Track.Thumb>
                                            <Thumb Style="{StaticResource ScrollBarThumb}"/>
                                        </Track.Thumb>
                                        <Track.IncreaseRepeatButton>
                                            <RepeatButton Style="{StaticResource ScrollBarPageButton}"
                                                          Command="ScrollBar.PageRightCommand"/>
                                        </Track.IncreaseRepeatButton>
                                    </Track>
                                </Grid>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!--  DATAGRID  -->
        <Style TargetType="DataGrid">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeFgSecondaryB}"/>
            <Setter Property="BorderThickness"
                    Value="0"/>
            <Setter Property="RowBackground"
                    Value="Transparent"/>
            <Setter Property="AlternatingRowBackground"
                    Value="{DynamicResource ThemeBg0B}"/>
            <Setter Property="GridLinesVisibility"
                    Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush"
                    Value="{DynamicResource ThemeStrokeB}"/>
            <Setter Property="HeadersVisibility"
                    Value="Column"/>
            <Setter Property="RowHeight"
                    Value="36"/>
            <Setter Property="ColumnHeaderHeight"
                    Value="34"/>
            <Setter Property="CanUserAddRows"
                    Value="False"/>
            <Setter Property="CanUserResizeRows"
                    Value="False"/>
            <Setter Property="SelectionMode"
                    Value="Single"/>
            <Setter Property="SelectionUnit"
                    Value="FullRow"/>
            <Setter Property="AutoGenerateColumns"
                    Value="False"/>
            <Setter Property="IsReadOnly"
                    Value="True"/>
            <Setter Property="FontSize"
                    Value="11"/>
            <Setter Property="FontFamily"
                    Value="Segoe UI Semibold"/>
        </Style>
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background"
                    Value="{DynamicResource ThemeBg0B}"/>
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeMutedB}"/>
            <Setter Property="FontWeight"
                    Value="Bold"/>
            <Setter Property="FontSize"
                    Value="9"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridColumnHeader">
                        <Border Background="{DynamicResource ThemeBg0B}"
                                BorderBrush="{DynamicResource ThemeStrokeB}"
                                BorderThickness="0,0,0,1"
                                Padding="10,0">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="DataGridCell">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="BorderThickness"
                    Value="0"/>
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeFgSecondaryB}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <Border x:Name="Bd"
                                Background="Transparent"
                                Padding="10,0"
                                SnapsToDevicePixels="True">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="Transparent"/>
                                <Setter Property="Foreground"
                                        Value="{DynamicResource ThemeFgB}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="DataGridRow">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="BorderThickness"
                    Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridRow">
                        <Border x:Name="DGR_Border"
                                Background="{TemplateBinding Background}"
                                BorderThickness="0"
                                SnapsToDevicePixels="True">
                            <SelectiveScrollingGrid>
                                <SelectiveScrollingGrid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </SelectiveScrollingGrid.ColumnDefinitions>
                                <SelectiveScrollingGrid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </SelectiveScrollingGrid.RowDefinitions>
                                <DataGridCellsPresenter Grid.Column="1"
                                                        ItemsPanel="{TemplateBinding ItemsPanel}"
                                                        SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                <DataGridDetailsPresenter Grid.Column="1"
                                                          Grid.Row="1"
                                                          SelectiveScrollingGrid.SelectiveScrollingOrientation="{Binding AreRowDetailsFrozen, ConverterParameter={x:Static SelectiveScrollingOrientation.Vertical}, Converter={x:Static DataGrid.RowDetailsScrollingConverter}, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"
                                                          Visibility="{TemplateBinding DetailsVisibility}"/>
                                <DataGridRowHeader Grid.RowSpan="2"
                                                   SelectiveScrollingGrid.SelectiveScrollingOrientation="Vertical"
                                                   Visibility="{Binding HeadersVisibility, ConverterParameter={x:Static DataGridHeadersVisibility.Row}, Converter={x:Static DataGrid.HeadersVisibilityConverter}, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"/>
                            </SelectiveScrollingGrid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="DGR_Border"
                                        Property="Background"
                                        Value="{DynamicResource ThemeBg2B}"/>
                            </Trigger>
                            <Trigger Property="IsSelected"
                                     Value="True">
                                <Setter TargetName="DGR_Border"
                                        Property="Background"
                                        Value="{DynamicResource ThemeBg2B}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="DataGridRowHeader">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="BorderThickness"
                    Value="0"/>
            <Setter Property="Width"
                    Value="0"/>
        </Style>

        <!--  Helper Styles  -->
        <Style x:Key="Lbl"
               TargetType="TextBlock">
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeMutedB}"/>
            <Setter Property="FontSize"
                    Value="10"/>
            <Setter Property="FontWeight"
                    Value="Medium"/>
            <Setter Property="Margin"
                    Value="0,0,0,4"/>
        </Style>
        <Style x:Key="CardTitle"
               TargetType="TextBlock">
            <Setter Property="FontSize"
                    Value="13"/>
            <Setter Property="FontWeight"
                    Value="Bold"/>
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeFgB}"/>
            <Setter Property="Margin"
                    Value="0,0,0,12"/>
        </Style>
        <Style x:Key="KpiValue"
               TargetType="TextBlock">
            <Setter Property="FontSize"
                    Value="26"/>
            <Setter Property="FontWeight"
                    Value="Bold"/>
            <Setter Property="Margin"
                    Value="0,4,0,0"/>
        </Style>
        <Style x:Key="KpiLabel"
               TargetType="TextBlock">
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeMutedB}"/>
            <Setter Property="FontSize"
                    Value="9"/>
            <Setter Property="FontWeight"
                    Value="Bold"/>
        </Style>
        <Style x:Key="KpiSub"
               TargetType="TextBlock">
            <Setter Property="Foreground"
                    Value="{DynamicResource ThemeMutedB}"/>
            <Setter Property="FontSize"
                    Value="10"/>
            <Setter Property="Margin"
                    Value="0,3,0,0"/>
        </Style>
        <Style x:Key="MRow"
               TargetType="Grid">
            <Setter Property="Margin"
                    Value="0,0,0,8"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="220"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!--  BARRA LATERAL  -->
        <Border Grid.Column="0"
                BorderThickness="0,0,1,0"
                BorderBrush="{DynamicResource ThemeStrokeB}"
                Background="{DynamicResource ThemeBg1B}">
            <DockPanel Margin="16,18,16,16">
                <StackPanel DockPanel.Dock="Top">
                    <StackPanel Orientation="Horizontal"
                                Margin="0,0,0,2">
                        <TextBlock Text="📊"
                                   FontSize="20"
                                   Margin="0,0,6,0"/>
                        <TextBlock Text="ZyphraTrades"
                                   FontSize="17"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource ThemeFgB}"/>
                    </StackPanel>
                    <TextBlock Text="Diario de Trading Profesional"
                               Foreground="{DynamicResource ThemeMutedB}"
                               FontSize="9"
                               FontWeight="Medium"/>
                    <Border Height="1"
                            Margin="0,14,0,6"
                            Background="{DynamicResource ThemeStrokeB}"
                            Opacity="0.5"/>
                </StackPanel>

                <StackPanel DockPanel.Dock="Top"
                            Margin="0,6,0,0">
                    <TextBlock Text="OPERACIONES"
                               Foreground="{DynamicResource ThemeMutedB}"
                               FontSize="8"
                               FontWeight="Bold"
                               Margin="12,0,0,4"
                               Opacity="0.6"/>
                    <Button Content="➕  Nuevo Trade"
                            Command="{Binding NavigateCommand}"
                            CommandParameter="AddTrade">
                        <Button.Style>
                            <Style TargetType="Button"
                                   BasedOn="{StaticResource NavItem}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentPage}"
                                                 Value="AddTrade">
                                        <Setter Property="Tag"
                                                Value="Active"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                    <Button Content="📋  Registro"
                            Command="{Binding NavigateCommand}"
                            CommandParameter="Trades">
                        <Button.Style>
                            <Style TargetType="Button"
                                   BasedOn="{StaticResource NavItem}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentPage}"
                                                 Value="Trades">
                                        <Setter Property="Tag"
                                                Value="Active"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                    <Border Height="1"
                            Background="{DynamicResource ThemeStrokeB}"
                            Margin="0,10"
                            Opacity="0.5"/>
                    <TextBlock Text="ANÁLISIS"
                               Foreground="{DynamicResource ThemeMutedB}"
                               FontSize="8"
                               FontWeight="Bold"
                               Margin="12,0,0,4"
                               Opacity="0.6"/>
                    <Button Content="📊  Panel"
                            Command="{Binding NavigateCommand}"
                            CommandParameter="Dashboard">
                        <Button.Style>
                            <Style TargetType="Button"
                                   BasedOn="{StaticResource NavItem}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentPage}"
                                                 Value="Dashboard">
                                        <Setter Property="Tag"
                                                Value="Active"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                    <Border Height="1"
                            Background="{DynamicResource ThemeStrokeB}"
                            Margin="0,10"
                            Opacity="0.5"/>
                    <TextBlock Text="SISTEMA"
                               Foreground="{DynamicResource ThemeMutedB}"
                               FontSize="8"
                               FontWeight="Bold"
                               Margin="12,0,0,4"
                               Opacity="0.6"/>
                    <Button Content="⚙️  Ajustes"
                            Command="{Binding NavigateCommand}"
                            CommandParameter="Settings">
                        <Button.Style>
                            <Style TargetType="Button"
                                   BasedOn="{StaticResource NavItem}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentPage}"
                                                 Value="Settings">
                                        <Setter Property="Tag"
                                                Value="Active"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>

                <StackPanel DockPanel.Dock="Bottom"
                            VerticalAlignment="Bottom">
                    <Border Height="1"
                            Margin="0,12"
                            Opacity="0.4"
                            Background="{DynamicResource ThemeStrokeB}"/>
                    <TextBlock Text="ESTADO"
                               Foreground="{DynamicResource ThemeMutedB}"
                               FontSize="8"
                               FontWeight="Bold"
                               Opacity="0.5"/>
                    <TextBlock Text="{Binding StatusText}"
                               FontSize="10"
                               Margin="0,3,0,0"
                               TextWrapping="Wrap"
                               Foreground="{DynamicResource ThemeMutedB}"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!--  CONTENIDO  -->
        <Grid Grid.Column="1"
              Background="{DynamicResource ThemeBg0B}">

            <!--  PÁGINA: NUEVO/EDITAR TRADE  -->
            <Grid Visibility="{Binding CurrentPage, Converter={StaticResource PageVis}, ConverterParameter=AddTrade}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <!-- Header -->
                <Border Grid.Row="0"
                        BorderThickness="0,0,0,1"
                        BorderBrush="{DynamicResource ThemeStrokeB}"
                        Background="{DynamicResource ThemeBg1B}">
                    <Grid Margin="24,12">
                        <StackPanel>
                            <TextBlock Text="{Binding TradeForm.FormTitle}"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       Foreground="{DynamicResource ThemeFgB}"/>
                            <TextBlock Text="Completa los detalles para un registro preciso"
                                       Foreground="{DynamicResource ThemeMutedB}"
                                       FontSize="10"
                                       Margin="0,2,0,0"/>
                        </StackPanel>
                        <StackPanel HorizontalAlignment="Right"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center">
                            <Button Style="{StaticResource BtnGhost}"
                                    Content=" Limpiar"
                                    Margin="0,0,8,0"
                                    Command="{Binding TradeForm.ResetCommand}"/>
                            <Button Style="{StaticResource BtnPrimary}"
                                    Content="  Guardar Trade"
                                    Command="{Binding TradeForm.SaveCommand}"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Form Body -->
                <ScrollViewer Grid.Row="1"
                              VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="24,16,24,24">

                        <!--  ANÁLISIS MULTI-TIMEFRAME (PRIORIDAD VISUAL)  -->
                        <Border Style="{StaticResource Card}"
                                Margin="0,0,0,12">
                            <StackPanel>
                                <TextBlock Text="  Análisis Multi-Timeframe"
                                           Style="{StaticResource CardTitle}"/>
                                <TextBlock Text="Mayor a Menor · Configurado desde Ajustes"
                                           Foreground="{DynamicResource ThemeMutedB}"
                                           FontSize="10"
                                           Margin="0,-8,0,12"/>
                                <ItemsControl ItemsSource="{Binding TradeForm.TimeframeAnalyses}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Margin="0,0,0,8"
                                                    Padding="14,12"
                                                    CornerRadius="10"
                                                    Background="{DynamicResource ThemeTfCardBgB}"
                                                    BorderBrush="{DynamicResource ThemeTfCardBorderB}"
                                                    BorderThickness="1">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="60"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="12"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <!-- Badge del Timeframe -->
                                                    <Border CornerRadius="8"
                                                            Background="{DynamicResource ThemeBg2B}"
                                                            Width="48"
                                                            Height="36"
                                                            VerticalAlignment="Top"
                                                            Margin="0,4,0,0">
                                                        <TextBlock Text="{Binding Timeframe}"
                                                                   FontSize="13"
                                                                   FontWeight="Bold"
                                                                   Foreground="{DynamicResource ThemeCyanB}"
                                                                   HorizontalAlignment="Center"
                                                                   VerticalAlignment="Center"/>
                                                    </Border>
                                                    <!-- Captura -->
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="Ruta de Captura"
                                                                   Style="{StaticResource Lbl}"/>
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <TextBox Text="{Binding ScreenshotPath, UpdateSourceTrigger=PropertyChanged}"/>
                                                            <Button Grid.Column="1"
                                                                    Content=""
                                                                    Margin="6,0,0,0"
                                                                    Padding="8,5"
                                                                    Style="{StaticResource BtnGhost}"
                                                                    Command="{Binding DataContext.TradeForm.BrowseScreenshotCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                    CommandParameter="{Binding}"/>
                                                        </Grid>
                                                    </StackPanel>
                                                    <!-- Análisis -->
                                                    <StackPanel Grid.Column="3">
                                                        <TextBlock Text="Análisis"
                                                                   Style="{StaticResource Lbl}"/>
                                                        <TextBox Text="{Binding Analysis, UpdateSourceTrigger=PropertyChanged}"
                                                                 AcceptsReturn="True"
                                                                 TextWrapping="Wrap"
                                                                 Height="56"
                                                                 VerticalScrollBarVisibility="Auto"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                        <!--  INFORMACIÓN BÁSICA + PRECIOS (2 columnas)  -->
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="12"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Info Básica -->
                            <Border Grid.Column="0"
                                    Style="{StaticResource Card}">
                                <StackPanel>
                                    <TextBlock Text="  Información Básica"
                                               Style="{StaticResource CardTitle}"/>
                                    <TextBlock Text="Símbolo"
                                               Style="{StaticResource Lbl}"/>
                                    <TextBox Text="{Binding TradeForm.Symbol, UpdateSourceTrigger=PropertyChanged}"
                                             Margin="0,0,0,8"/>
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="8"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel>
                                            <TextBlock Text="Lado"
                                                       Style="{StaticResource Lbl}"/>
                                            <ComboBox ItemsSource="{Binding TradeForm.SideOptions}"
                                                      SelectedItem="{Binding TradeForm.SelectedSide}">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Converter={StaticResource EnumEs}}"/>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="Temporalidad"
                                                       Style="{StaticResource Lbl}"/>
                                            <ComboBox ItemsSource="{Binding TradeForm.TimeframeOptions}"
                                                      SelectedItem="{Binding TradeForm.SelectedTimeframe}"/>
                                        </StackPanel>
                                    </Grid>
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="8"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel>
                                            <TextBlock Text="Estado"
                                                       Style="{StaticResource Lbl}"/>
                                            <ComboBox ItemsSource="{Binding TradeForm.StatusOptions}"
                                                      SelectedItem="{Binding TradeForm.SelectedStatus}">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Converter={StaticResource EnumEs}}"/>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="Sesión"
                                                       Style="{StaticResource Lbl}"/>
                                            <ComboBox ItemsSource="{Binding TradeForm.SessionOptions}"
                                                      SelectedItem="{Binding TradeForm.SelectedSession}">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Converter={StaticResource EnumEs}}"/>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </StackPanel>
                                    </Grid>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="8"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel>
                                            <TextBlock Text="Fecha Apertura"
                                                       Style="{StaticResource Lbl}"/>
                                            <DatePicker SelectedDate="{Binding TradeForm.OpenDate}"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="Fecha Cierre"
                                                       Style="{StaticResource Lbl}"/>
                                            <DatePicker SelectedDate="{Binding TradeForm.CloseDate}"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Precios -->
                            <Border Grid.Column="2"
                                    Style="{StaticResource Card}">
                                <StackPanel>
                                    <TextBlock Text="  Precios y Niveles"
                                               Style="{StaticResource CardTitle}"/>
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="8"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel>
                                            <TextBlock Text="Precio Entrada"
                                                       Style="{StaticResource Lbl}"/>
                                            <TextBox Text="{Binding TradeForm.EntryPrice, TargetNullValue='', StringFormat={}{0:0.######}}"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="Precio Salida"
                                                       Style="{StaticResource Lbl}"/>
                                            <TextBox Text="{Binding TradeForm.ExitPrice, TargetNullValue='', StringFormat={}{0:0.######}}"/>
                                        </StackPanel>
                                    </Grid>
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="8"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel>
                                            <TextBlock Text="Stop Loss"
                                                       Style="{StaticResource Lbl}"/>
                                            <TextBox Text="{Binding TradeForm.StopLoss, TargetNullValue='', StringFormat={}{0:0.######}}"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="Take Profit"
                                                       Style="{StaticResource Lbl}"/>
                                            <TextBox Text="{Binding TradeForm.TakeProfit, TargetNullValue='', StringFormat={}{0:0.######}}"/>
                                        </StackPanel>
                                    </Grid>
                                    <Border Height="1"
                                            Background="{DynamicResource ThemeStrokeB}"
                                            Margin="0,0,0,10"
                                            Opacity="0.5"/>
                                    <TextBlock Text="Riesgo : Beneficio (auto)"
                                               Style="{StaticResource Lbl}"/>
                                    <TextBlock Text="{Binding TradeForm.RiskRewardDisplay, StringFormat=1 : {0:0.00}, TargetNullValue='--'}"
                                               FontSize="20"
                                               FontWeight="Bold"
                                               Foreground="{DynamicResource ThemeCyanB}"/>
                                </StackPanel>
                            </Border>
                        </Grid>

                        <!--  RESULTADOS + CONTEXTO (2 columnas)  -->
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="12"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Resultados -->
                            <Border Grid.Column="0"
                                    Style="{StaticResource Card}">
                                <StackPanel>
                                    <TextBlock Text="  Resultados"
                                               Style="{StaticResource CardTitle}"/>

                                    <!-- Selector de modo de riesgo: % o $ -->
                                    <Grid Margin="0,0,0,4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text=" Riesgo"
                                                   Style="{StaticResource Lbl}"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>
                                        <StackPanel Grid.Column="1"
                                                    Orientation="Horizontal"
                                                    HorizontalAlignment="Right">
                                            <RadioButton Content="$ Monto"
                                                         IsChecked="{Binding TradeForm.RiskAsPercent, Converter={StaticResource BoolInvert}}"
                                                         Margin="0,0,10,0"
                                                         VerticalAlignment="Center"
                                                         Foreground="{DynamicResource ThemeFgB}"/>
                                            <RadioButton Content="% Cuenta"
                                                         IsChecked="{Binding TradeForm.RiskAsPercent}"
                                                         VerticalAlignment="Center"
                                                         Foreground="{DynamicResource ThemeFgB}"/>
                                        </StackPanel>
                                    </Grid>

                                    <!-- Input: $ amount (cuando RiskAsPercent = false) -->
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="8"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <!-- % de la cuenta -->
                                        <StackPanel Visibility="{Binding TradeForm.RiskAsPercent, Converter={StaticResource BoolVis}}">
                                            <TextBlock Text="% de la Cuenta"
                                                       Style="{StaticResource Lbl}"/>
                                            <TextBox Text="{Binding TradeForm.RiskPercent, TargetNullValue='', StringFormat={}{0:0.##}}"/>
                                        </StackPanel>
                                        <StackPanel Visibility="{Binding TradeForm.RiskAsPercent, Converter={StaticResource BoolVis}}"
                                                    Grid.Column="2">
                                            <TextBlock Text="= Monto ($)"
                                                       Style="{StaticResource Lbl}"
                                                       Opacity="0.7"/>
                                            <TextBlock Text="{Binding TradeForm.RiskAmount, StringFormat=${}{0:N2}, TargetNullValue='--'}"
                                                       Foreground="{DynamicResource ThemeFgB}"
                                                       Opacity="0.7"
                                                       Margin="0,5,0,0"/>
                                        </StackPanel>
                                        <!-- $ monto directo -->
                                        <StackPanel Grid.ColumnSpan="3"
                                                    Visibility="{Binding TradeForm.RiskAsPercent, Converter={StaticResource BoolVisInv}}">
                                            <TextBlock Text="Monto Riesgo ($)"
                                                       Style="{StaticResource Lbl}"/>
                                            <TextBox Text="{Binding TradeForm.RiskAmount, TargetNullValue='', StringFormat={}{0:0.##}}"/>
                                        </StackPanel>
                                    </Grid>

                                    <!-- Auto-calculados -->
                                    <Grid Margin="0,0,0,6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="8"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="8"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel>
                                            <TextBlock Text="PnL ($)"
                                                       Style="{StaticResource Lbl}"/>
                                            <TextBlock Text="{Binding TradeForm.NetPnl, StringFormat={}{0:+0.00;-0.00;0.00}}"
                                                       FontSize="16"
                                                       FontWeight="SemiBold"
                                                       Foreground="{Binding TradeForm.NetPnl, Converter={StaticResource PnlBrush}}"
                                                       Margin="0,2,0,0"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="Resultado R"
                                                       Style="{StaticResource Lbl}"/>
                                            <TextBlock Text="{Binding TradeForm.ResultR, StringFormat={}{0:+0.00;-0.00;0}R, TargetNullValue='--'}"
                                                       FontSize="16"
                                                       FontWeight="SemiBold"
                                                       Foreground="{Binding TradeForm.NetPnl, Converter={StaticResource PnlBrush}}"
                                                       Margin="0,2,0,0"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="4">
                                            <TextBlock Text="R:R Planeado"
                                                       Style="{StaticResource Lbl}"/>
                                            <TextBlock Text="{Binding TradeForm.RiskRewardDisplay, StringFormat=1:{0:0.0}, TargetNullValue='--'}"
                                                       FontSize="16"
                                                       FontWeight="SemiBold"
                                                       Foreground="{DynamicResource FgPrimary}"
                                                       Margin="0,2,0,0"/>
                                        </StackPanel>
                                    </Grid>

                                    <!-- Balance auto-calculado (sutil, no editable) -->
                                    <Border BorderThickness="0,1,0,0"
                                            BorderBrush="{DynamicResource Border}"
                                            Margin="0,8,0,0"
                                            Padding="0,8,0,0">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="8"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel>
                                                <TextBlock Text="Balance Actual"
                                                           Style="{StaticResource Lbl}"
                                                           Opacity="0.7"/>
                                                <TextBlock Text="{Binding TradeForm.AccountBalanceBefore, StringFormat=${}{0:N2}, TargetNullValue='--'}"
                                                           Foreground="{DynamicResource FgPrimary}"
                                                           Opacity="0.7"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2">
                                                <TextBlock Text="Balance Final"
                                                           Style="{StaticResource Lbl}"
                                                           Opacity="0.7"/>
                                                <TextBlock Text="{Binding TradeForm.AccountBalanceAfter, StringFormat=${}{0:N2}, TargetNullValue='--'}"
                                                           Foreground="{Binding TradeForm.NetPnl, Converter={StaticResource PnlBrush}}"
                                                           Opacity="0.7"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </StackPanel>
                            </Border>

                            <!-- Contexto & Setup -->
                            <Border Grid.Column="2"
                                    Style="{StaticResource Card}">
                                <StackPanel>
                                    <TextBlock Text="  Contexto y Setup"
                                               Style="{StaticResource CardTitle}"/>
                                    <TextBlock Text="Setup (ej: Break &amp; Retest)"
                                               Style="{StaticResource Lbl}"/>
                                    <TextBox Text="{Binding TradeForm.Setup, UpdateSourceTrigger=PropertyChanged}"
                                             Margin="0,0,0,8"/>
                                    <TextBlock Text="Estrategia"
                                               Style="{StaticResource Lbl}"/>
                                    <TextBox Text="{Binding TradeForm.Strategy, UpdateSourceTrigger=PropertyChanged}"
                                             Margin="0,0,0,8"/>
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="8"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel>
                                            <TextBlock Text="Condición Mercado"
                                                       Style="{StaticResource Lbl}"/>
                                            <ComboBox ItemsSource="{Binding TradeForm.MarketConditionOptions}"
                                                      SelectedItem="{Binding TradeForm.MarketCondition}">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Converter={StaticResource EnumEs}}"/>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="Confluencia"
                                                       Style="{StaticResource Lbl}"/>
                                            <ComboBox ItemsSource="{Binding TradeForm.ConfluenceOptions}"
                                                      SelectedItem="{Binding TradeForm.Confluence}">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Converter={StaticResource EnumEs}}"/>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </StackPanel>
                                    </Grid>
                                    <TextBlock Text="Tags (separados por coma)"
                                               Style="{StaticResource Lbl}"/>
                                    <TextBox Text="{Binding TradeForm.Tags, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>
                            </Border>
                        </Grid>

                        <!--  CHECKLIST (full width)  -->
                        <Border Style="{StaticResource Card}"
                                Margin="0,0,0,12">
                            <StackPanel>
                                <Grid Margin="0,0,0,10">
                                    <TextBlock Text="✅  Checklist del Plan"
                                               Style="{StaticResource CardTitle}"
                                               Margin="0"/>
                                    <Border HorizontalAlignment="Right"
                                            CornerRadius="6"
                                            Padding="8,4"
                                            Background="{DynamicResource ThemeWinBgB}">
                                        <TextBlock Text="{Binding TradeForm.ChecklistSummary}"
                                                   FontSize="12"
                                                   FontWeight="Bold"
                                                   Foreground="{DynamicResource ThemeWinTextB}"/>
                                    </Border>
                                </Grid>
                                <ItemsControl ItemsSource="{Binding TradeForm.ChecklistItems}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Margin="0,0,0,3"
                                                    Padding="10,8"
                                                    CornerRadius="6"
                                                    Background="{DynamicResource ThemeBg0B}"
                                                    BorderBrush="{DynamicResource ThemeStrokeB}"
                                                    BorderThickness="1">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="180"/>
                                                    </Grid.ColumnDefinitions>
                                                    <CheckBox IsChecked="{Binding IsChecked}"
                                                              VerticalAlignment="Center"
                                                              Margin="0,0,10,0"/>
                                                    <StackPanel Grid.Column="1"
                                                                VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding RuleName}"
                                                                   FontSize="12"
                                                                   FontWeight="SemiBold"/>
                                                        <Border CornerRadius="3"
                                                                Background="{DynamicResource ThemeBg2B}"
                                                                Padding="5,1"
                                                                HorizontalAlignment="Left"
                                                                Margin="0,2,0,0">
                                                            <TextBlock Text="{Binding Category}"
                                                                       FontSize="8"
                                                                       FontWeight="Bold"
                                                                       Foreground="{DynamicResource ThemeMutedB}"/>
                                                        </Border>
                                                    </StackPanel>
                                                    <TextBox Grid.Column="2"
                                                             Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}"
                                                             ToolTip="Notas"
                                                             VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                        <!--  PSICOLOGÍA (Accordion)  -->
                        <Button Style="{StaticResource BtnAccordion}"
                                Margin="0,0,0,4"
                                Content="  Psicología y PNL "
                                Command="{Binding TradeForm.TogglePsychologyCommand}"/>
                        <Border Style="{StaticResource Card}"
                                Margin="0,0,0,12"
                                Visibility="{Binding TradeForm.ShowPsychology, Converter={StaticResource BoolVis}}">
                            <StackPanel>
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Emoción Antes"
                                                   Style="{StaticResource Lbl}"/>
                                        <ComboBox ItemsSource="{Binding TradeForm.EmotionOptions}"
                                                  SelectedItem="{Binding TradeForm.EmotionBefore}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Converter={StaticResource EnumEs}}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Emoción Después"
                                                   Style="{StaticResource Lbl}"/>
                                        <ComboBox ItemsSource="{Binding TradeForm.EmotionOptions}"
                                                  SelectedItem="{Binding TradeForm.EmotionAfter}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Converter={StaticResource EnumEs}}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </StackPanel>
                                    <StackPanel Grid.Column="4">
                                        <TextBlock Text="Confianza (1-5)"
                                                   Style="{StaticResource Lbl}"/>
                                        <ComboBox ItemsSource="{Binding TradeForm.ConfidenceLevelOptions}"
                                                  SelectedItem="{Binding TradeForm.ConfidenceLevel}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="6">
                                        <TextBlock Text="Rating (1-5)"
                                                   Style="{StaticResource Lbl}"/>
                                        <ComboBox ItemsSource="{Binding TradeForm.RatingOptions}"
                                                  SelectedItem="{Binding TradeForm.Rating}"/>
                                    </StackPanel>
                                </Grid>
                                <TextBlock Text="Observación Post-Trade"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.PostTradeObservation, UpdateSourceTrigger=PropertyChanged}"
                                         AcceptsReturn="True"
                                         TextWrapping="Wrap"
                                         Height="50"
                                         VerticalScrollBarVisibility="Auto"
                                         Margin="0,0,0,8"/>
                                <TextBlock Text="Compromiso de Mejora"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.ImprovementCommitment, UpdateSourceTrigger=PropertyChanged}"
                                         AcceptsReturn="True"
                                         TextWrapping="Wrap"
                                         Height="50"
                                         VerticalScrollBarVisibility="Auto"/>
                            </StackPanel>
                        </Border>

                        <!--  DIARIO (Accordion)  -->
                        <Button Style="{StaticResource BtnAccordion}"
                                Margin="0,0,0,4"
                                Content="  Diario "
                                Command="{Binding TradeForm.ToggleJournalCommand}"/>
                        <Border Style="{StaticResource Card}"
                                Margin="0,0,0,12"
                                Visibility="{Binding TradeForm.ShowJournal, Converter={StaticResource BoolVis}}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="12"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="12"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="Notas"
                                               Style="{StaticResource Lbl}"/>
                                    <TextBox Text="{Binding TradeForm.Notes, UpdateSourceTrigger=PropertyChanged}"
                                             AcceptsReturn="True"
                                             TextWrapping="Wrap"
                                             Height="80"
                                             VerticalScrollBarVisibility="Auto"/>
                                </StackPanel>
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Errores"
                                               Style="{StaticResource Lbl}"/>
                                    <TextBox Text="{Binding TradeForm.MistakeNotes, UpdateSourceTrigger=PropertyChanged}"
                                             AcceptsReturn="True"
                                             TextWrapping="Wrap"
                                             Height="80"
                                             VerticalScrollBarVisibility="Auto"/>
                                </StackPanel>
                                <StackPanel Grid.Column="4">
                                    <TextBlock Text="Lección Aprendida"
                                               Style="{StaticResource Lbl}"/>
                                    <TextBox Text="{Binding TradeForm.LessonLearned, UpdateSourceTrigger=PropertyChanged}"
                                             AcceptsReturn="True"
                                             TextWrapping="Wrap"
                                             Height="80"
                                             VerticalScrollBarVisibility="Auto"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!--  PARCIALES (Accordion)  -->
                        <Button Style="{StaticResource BtnAccordion}"
                                Margin="0,0,0,4"
                                Content="✂  Parciales y Breakeven ✂"
                                Command="{Binding TradeForm.TogglePartialsCommand}"/>
                        <Border Style="{StaticResource Card}"
                                Margin="0,0,0,12"
                                Visibility="{Binding TradeForm.ShowPartials, Converter={StaticResource BoolVis}}">
                            <StackPanel>
                                <Grid Margin="0,0,0,10">
                                    <TextBlock Text="Take-Profits Parciales"
                                               Style="{StaticResource CardTitle}"
                                               Margin="0"/>
                                    <Button Content="➕ Agregar"
                                            HorizontalAlignment="Right"
                                            Style="{StaticResource BtnGhost}"
                                            Padding="10,5"
                                            Command="{Binding TradeForm.AddPartialCommand}"/>
                                </Grid>
                                <ItemsControl ItemsSource="{Binding TradeForm.Partials}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Margin="0,0,0,4"
                                                    Padding="10,8"
                                                    CornerRadius="8"
                                                    Background="{DynamicResource ThemeBg0B}"
                                                    BorderBrush="{DynamicResource ThemeStrokeB}"
                                                    BorderThickness="1">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="28"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="8"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="8"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="8"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <!-- # Index -->
                                                    <Border CornerRadius="4"
                                                            Background="{DynamicResource ThemeBg2B}"
                                                            Width="22"
                                                            Height="22">
                                                        <TextBlock Text="{Binding Index, StringFormat=#{0}}"
                                                                   FontWeight="Bold"
                                                                   FontSize="10"
                                                                   Foreground="{DynamicResource ThemeAccentB}"
                                                                   HorizontalAlignment="Center"
                                                                   VerticalAlignment="Center"/>
                                                    </Border>
                                                    <!-- % Posición cerrada -->
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="% Posición"
                                                                   Style="{StaticResource Lbl}"/>
                                                        <TextBox Text="{Binding PercentClosed, StringFormat={}{0:0}}"
                                                                 ToolTip="Porcentaje de la posición que cerraste"/>
                                                    </StackPanel>
                                                    <!-- Precio de salida -->
                                                    <StackPanel Grid.Column="3">
                                                        <TextBlock Text="Precio Salida"
                                                                   Style="{StaticResource Lbl}"/>
                                                        <TextBox Text="{Binding ExitPrice, StringFormat={}{0:0.######}}"
                                                                 ToolTip="Precio al que cerraste el parcial"/>
                                                    </StackPanel>
                                                    <!-- RR del parcial -->
                                                    <StackPanel Grid.Column="5">
                                                        <TextBlock Text="RR Alcanzado"
                                                                   Style="{StaticResource Lbl}"/>
                                                        <TextBox Text="{Binding ExitRR, TargetNullValue='', StringFormat={}{0:0.##}}"
                                                                 ToolTip="Múltiplo de R al que sacaste (ej: 1.5)"/>
                                                    </StackPanel>
                                                    <!-- Eliminar -->
                                                    <Button Grid.Column="7"
                                                            Content="➕"
                                                            Style="{StaticResource BtnGhost}"
                                                            Padding="6,4"
                                                            FontSize="10"
                                                            VerticalAlignment="Center"
                                                            Command="{Binding DataContext.TradeForm.RemovePartialCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                    </StackPanel>
                </ScrollViewer>
            </Grid>

            <!--  PÁGINA: REGISTRO DE TRADES  -->
            <Grid Visibility="{Binding CurrentPage, Converter={StaticResource PageVis}, ConverterParameter=Trades}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <!-- Header -->
                <Border Grid.Row="0"
                        BorderThickness="0,0,0,1"
                        BorderBrush="{DynamicResource ThemeStrokeB}"
                        Background="{DynamicResource ThemeBg1B}">
                    <Grid Margin="24,12">
                        <StackPanel>
                            <TextBlock Text="Registro de Trades"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       Foreground="{DynamicResource ThemeFgB}"/>
                            <TextBlock Text="Todas las operaciones · Filtra y analiza"
                                       Foreground="{DynamicResource ThemeMutedB}"
                                       FontSize="10"
                                       Margin="0,2,0,0"/>
                        </StackPanel>
                        <StackPanel HorizontalAlignment="Right"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center">
                            <Button Style="{StaticResource BtnGhost}"
                                    Content="📤 Exportar"
                                    Margin="0,0,6,0"
                                    Command="{Binding ExportCsvCommand}"/>
                            <Button Style="{StaticResource BtnGhost}"
                                    Content="✏️ Editar"
                                    Margin="0,0,6,0"
                                    Command="{Binding EditSelectedCommand}"/>
                            <Button Style="{StaticResource BtnGhost}"
                                    Content="🗑 Eliminar"
                                    Margin="0,0,6,0"
                                    Command="{Binding DeleteSelectedCommand}"/>
                            <Button Style="{StaticResource BtnPrimary}"
                                    Content=" Actualizar"
                                    Command="{Binding RefreshCommand}"/>
                        </StackPanel>
                    </Grid>
                </Border>
                <!-- Filtros -->
                <Border Grid.Row="1"
                        Margin="24,10,24,0"
                        Style="{StaticResource Card}"
                        Padding="12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="160"/>
                            <ColumnDefinition Width="8"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="8"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="8"/>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="8"/>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="6"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Text="{Binding SymbolFilter, UpdateSourceTrigger=PropertyChanged}"
                                 ToolTip="Símbolo"/>
                        <ComboBox Grid.Column="2"
                                  SelectedItem="{Binding SideFilter}"
                                  ItemsSource="{Binding SideFilterOptions}"/>
                        <ComboBox Grid.Column="4"
                                  SelectedItem="{Binding StatusFilter}"
                                  ItemsSource="{Binding StatusFilterOptions}"/>
                        <DatePicker Grid.Column="6"
                                    SelectedDate="{Binding FromDate}"/>
                        <DatePicker Grid.Column="8"
                                    SelectedDate="{Binding ToDate}"/>
                        <Button Grid.Column="10"
                                Style="{StaticResource BtnPrimary}"
                                Content="Filtrar"
                                Command="{Binding ApplyFilterCommand}"/>
                        <Button Grid.Column="12"
                                Style="{StaticResource BtnGhost}"
                                Content="Limpiar"
                                Command="{Binding ClearFilterCommand}"/>
                    </Grid>
                </Border>
                <!-- Tabla de Trades -->
                <Grid Grid.Row="2"
                      Margin="24,10,24,24">
                    <Border Style="{StaticResource Card}"
                            Padding="0">
                        <DataGrid x:Name="TradesGrid"
                                  ItemsSource="{Binding TradesView}"
                                  SelectedItem="{Binding SelectedTrade}"
                                  MouseDoubleClick="TradesGrid_MouseDoubleClick"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  SelectionMode="Single"
                                  SelectionUnit="FullRow"
                                  GridLinesVisibility="None"
                                  HeadersVisibility="Column"
                                  BorderThickness="0"
                                  Background="Transparent"
                                  RowBackground="Transparent"
                                  Foreground="{DynamicResource ThemeFgB}"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserResizeRows="False"
                                  Margin="0">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background"
                                            Value="Transparent"/>
                                    <Setter Property="Foreground"
                                            Value="{DynamicResource ThemeMutedB}"/>
                                    <Setter Property="FontSize"
                                            Value="9"/>
                                    <Setter Property="FontWeight"
                                            Value="Bold"/>
                                    <Setter Property="Padding"
                                            Value="14,10"/>
                                    <Setter Property="BorderBrush"
                                            Value="{DynamicResource ThemeStrokeB}"/>
                                    <Setter Property="BorderThickness"
                                            Value="0,0,0,1"/>
                                    <Setter Property="SeparatorVisibility"
                                            Value="Collapsed"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow">
                                    <Setter Property="Background"
                                            Value="Transparent"/>
                                    <Setter Property="Cursor"
                                            Value="Hand"/>
                                    <Setter Property="MinHeight"
                                            Value="40"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver"
                                                Value="True">
                                            <Setter Property="Background"
                                                    Value="{DynamicResource ThemeBg2B}"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected"
                                                Value="True">
                                            <Setter Property="Background"
                                                    Value="{DynamicResource ThemeBg2B}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.RowStyle>
                            <DataGrid.CellStyle>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="BorderThickness"
                                            Value="0"/>
                                    <Setter Property="Padding"
                                            Value="14,8"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="DataGridCell">
                                                <Border Background="{TemplateBinding Background}"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected"
                                                Value="True">
                                            <Setter Property="Background"
                                                    Value="Transparent"/>
                                            <Setter Property="Foreground"
                                                    Value="{DynamicResource ThemeFgB}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.CellStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="FECHA"
                                                    Binding="{Binding OpenedAt, StringFormat=yyyy-MM-dd}"
                                                    Width="95">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground"
                                                    Value="{DynamicResource ThemeMutedB}"/>
                                            <Setter Property="VerticalAlignment"
                                                    Value="Center"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="SÍMBOLO"
                                                    Binding="{Binding Symbol}"
                                                    Width="85">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="FontWeight"
                                                    Value="Bold"/>
                                            <Setter Property="Foreground"
                                                    Value="{DynamicResource ThemeFgB}"/>
                                            <Setter Property="VerticalAlignment"
                                                    Value="Center"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTemplateColumn Header="LADO"
                                        Width="75">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Side, Converter={StaticResource EnumEs}}"
                                                       FontWeight="Bold"
                                                       FontSize="11"
                                                       VerticalAlignment="Center"
                                                       Foreground="{Binding Side, Converter={StaticResource SideBrush}}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="TF"
                                                    Binding="{Binding Timeframe}"
                                                    Width="50"/>
                                <DataGridTextColumn Header="ENTRADA"
                                                    Binding="{Binding EntryPrice}"
                                                    Width="85"/>
                                <DataGridTextColumn Header="SALIDA"
                                                    Binding="{Binding ExitPrice}"
                                                    Width="85"/>
                                <DataGridTemplateColumn Header="PNL NETO"
                                        Width="105">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding NetPnl, StringFormat={}{0:N2}}"
                                                       FontWeight="Bold"
                                                       FontSize="12"
                                                       VerticalAlignment="Center"
                                                       Foreground="{Binding NetPnl, Converter={StaticResource PnlBrush}}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Header="R"
                                        Width="65">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding ResultR, StringFormat={}{0:0.00}R}"
                                                       FontWeight="SemiBold"
                                                       VerticalAlignment="Center"
                                                       Foreground="{Binding ResultR, Converter={StaticResource PnlBrush}}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="SETUP"
                                                    Binding="{Binding Setup}"
                                                    Width="110"/>
                                <DataGridTemplateColumn Header="RATING"
                                        Width="90">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Rating, Converter={StaticResource Stars}}"
                                                       FontSize="13"
                                                       VerticalAlignment="Center"
                                                       Foreground="{DynamicResource ThemeAmberB}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                </Grid>
            </Grid>

            <!--  PÁGINA: PANEL (Dashboard)  -->
            <ScrollViewer VerticalScrollBarVisibility="Auto"
                          Visibility="{Binding CurrentPage, Converter={StaticResource PageVis}, ConverterParameter=Dashboard}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <!-- Header -->
                    <Border Grid.Row="0"
                            BorderThickness="0,0,0,1"
                            BorderBrush="{DynamicResource ThemeStrokeB}"
                            Background="{DynamicResource ThemeBg1B}">
                        <Grid Margin="24,12">
                            <StackPanel>
                                <TextBlock Text="Panel de Control"
                                           FontSize="18"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource ThemeFgB}"/>
                                <TextBlock Text="Estadísticas del portafolio en tiempo real"
                                           Foreground="{DynamicResource ThemeMutedB}"
                                           FontSize="10"
                                           Margin="0,2,0,0"/>
                            </StackPanel>
                            <Button Style="{StaticResource BtnPrimary}"
                                    Content=" Actualizar"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    Command="{Binding RefreshCommand}"/>
                        </Grid>
                    </Border>

                    <!-- KPI Fila 1 -->
                    <Grid Grid.Row="1"
                          Margin="24,16,24,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Style="{StaticResource DashCard}">
                            <StackPanel>
                                <TextBlock Text="TOTAL TRADES"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Text="{Binding Stats.TotalTrades}"
                                           Style="{StaticResource KpiValue}"/>
                                <TextBlock Style="{StaticResource KpiSub}">
                                    <Run Text="{Binding Stats.OpenTrades, Mode=OneWay}"/>
                                    <Run Text=" abiertos · "/>
                                    <Run Text="{Binding Stats.ClosedTrades, Mode=OneWay}"/>
                                    <Run Text=" cerrados"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="2"
                                Style="{StaticResource DashCard}">
                            <StackPanel>
                                <TextBlock Text="TASA DE ACIERTO"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Style="{StaticResource KpiValue}"
                                           Foreground="{DynamicResource ThemeWinTextB}">
                                    <Run Text="{Binding Stats.WinRate, StringFormat={}{0:0.0}%, Mode=OneWay}"/>
                                </TextBlock>
                                <TextBlock Style="{StaticResource KpiSub}">
                                    <Run Text="{Binding Stats.WinCount, Mode=OneWay}"/>
                                    <Run Text="G · "/>
                                    <Run Text="{Binding Stats.LossCount, Mode=OneWay}"/>
                                    <Run Text="P · "/>
                                    <Run Text="{Binding Stats.BreakEvenCount, Mode=OneWay}"/>
                                    <Run Text="BE"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="4"
                                Style="{StaticResource DashCard}">
                            <StackPanel>
                                <TextBlock Text="FACTOR DE BENEFICIO"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Text="{Binding Stats.ProfitFactor, StringFormat={}{0:0.00}}"
                                           Style="{StaticResource KpiValue}"
                                           Foreground="{DynamicResource ThemeCyanB}"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="6"
                                Style="{StaticResource DashCard}">
                            <StackPanel>
                                <TextBlock Text="ESPERANZA ($)"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Text="{Binding Stats.Expectancy, StringFormat={}{0:N2}}"
                                           Style="{StaticResource KpiValue}"
                                           Foreground="{Binding Stats.Expectancy, Converter={StaticResource PnlBrush}}"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- KPI Fila 2 -->
                    <Grid Grid.Row="2"
                          Margin="24,12,24,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Style="{StaticResource DashCard}">
                            <StackPanel>
                                <TextBlock Text="PNL NETO"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Text="{Binding Stats.NetPnl, StringFormat={}{0:N2}}"
                                           Style="{StaticResource KpiValue}"
                                           Foreground="{Binding Stats.NetPnl, Converter={StaticResource PnlBrush}}"/>
                                <TextBlock Style="{StaticResource KpiSub}">
                                    <Run Text="Costos: "/>
                                    <Run Text="{Binding Stats.TotalFees, StringFormat={}{0:N2}, Mode=OneWay}"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="2"
                                Style="{StaticResource DashCard}">
                            <StackPanel>
                                <TextBlock Text="R PROMEDIO"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Text="{Binding Stats.AverageR, StringFormat={}{0:0.00}R}"
                                           Style="{StaticResource KpiValue}"
                                           Foreground="{Binding Stats.AverageR, Converter={StaticResource PnlBrush}}"/>
                                <TextBlock Style="{StaticResource KpiSub}">
                                    <Run Text="Mejor: "/>
                                    <Run Text="{Binding Stats.BestR, StringFormat={}{0:0.00}R, Mode=OneWay}"/>
                                    <Run Text=" · Peor: "/>
                                    <Run Text="{Binding Stats.WorstR, StringFormat={}{0:0.00}R, Mode=OneWay}"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="4"
                                Style="{StaticResource DashCard}">
                            <StackPanel>
                                <TextBlock Text="MÁX DRAWDOWN"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Text="{Binding Stats.MaxDrawdown, StringFormat=${}{0:N2}}"
                                           Style="{StaticResource KpiValue}"
                                           Foreground="{DynamicResource ThemeLossTextB}"/>
                                <TextBlock Style="{StaticResource KpiSub}">
                                    <Run Text="{Binding Stats.MaxDrawdownPercent, StringFormat={}{0:0.0}%, Mode=OneWay}"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="6"
                                Style="{StaticResource DashCard}">
                            <StackPanel>
                                <TextBlock Text="MÁX PÉRD. CONSECUTIVAS"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Text="{Binding Stats.MaxConsecutiveLosses}"
                                           Style="{StaticResource KpiValue}"
                                           Foreground="{DynamicResource ThemeLossTextB}"/>
                                <TextBlock Style="{StaticResource KpiSub}">
                                    <Run Text="Máx Ganadas: "/>
                                    <Run Text="{Binding Stats.MaxConsecutiveWins, Mode=OneWay}"/>
                                    <Run Text=" · Racha: "/>
                                    <Run Text="{Binding Stats.CurrentStreak, Mode=OneWay}"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!--  ROW 3: Curva de Equidad (full width)  -->
                    <Border Grid.Row="3"
                            Style="{StaticResource Card}"
                            Margin="24,14,24,0">
                        <StackPanel>
                            <TextBlock Text="📈  Curva de Equidad"
                                       FontSize="14"
                                       FontWeight="Bold"
                                       Foreground="{DynamicResource ThemeFgB}"
                                       Margin="0,0,0,8"/>
                            <lvc:CartesianChart Series="{Binding EquitySeries}"
                                                Height="220"
                                                TooltipPosition="Top"
                                                AnimationsSpeed="00:00:00.300"/>
                        </StackPanel>
                    </Border>

                    <!--  ROW 4: PnL por Trade + Rendimiento Mensual  -->
                    <Grid Grid.Row="4"
                          Margin="24,14,24,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="📊  PnL por Trade"
                                           FontSize="14"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource ThemeFgB}"
                                           Margin="0,0,0,8"/>
                                <lvc:CartesianChart Series="{Binding PnlBarSeries}"
                                                    Height="200"
                                                    TooltipPosition="Top"
                                                    AnimationsSpeed="00:00:00.300"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="2"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="📅  Rendimiento Mensual"
                                           FontSize="14"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource ThemeFgB}"
                                           Margin="0,0,0,8"/>
                                <lvc:CartesianChart Series="{Binding MonthlyPnlSeries}"
                                                    XAxes="{Binding MonthlyXAxes}"
                                                    Height="200"
                                                    TooltipPosition="Top"
                                                    AnimationsSpeed="00:00:00.300"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!--  ROW 5: Win/Loss Pie + Distribución R  -->
                    <Grid Grid.Row="5"
                          Margin="24,14,24,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="🎯  Win / Loss / BE"
                                           FontSize="14"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource ThemeFgB}"
                                           Margin="0,0,0,8"/>
                                <lvc:PieChart Series="{Binding WinLossSeries}"
                                              Height="200"
                                              AnimationsSpeed="00:00:00.300"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="2"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="📐  Distribución de R"
                                           FontSize="14"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource ThemeFgB}"
                                           Margin="0,0,0,8"/>
                                <lvc:CartesianChart Series="{Binding RDistributionSeries}"
                                                    XAxes="{Binding RDistXAxes}"
                                                    Height="200"
                                                    TooltipPosition="Top"
                                                    AnimationsSpeed="00:00:00.300"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="4"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="📆  PnL por Día"
                                           FontSize="14"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource ThemeFgB}"
                                           Margin="0,0,0,8"/>
                                <lvc:CartesianChart Series="{Binding DayOfWeekSeries}"
                                                    XAxes="{Binding DayOfWeekXAxes}"
                                                    Height="200"
                                                    TooltipPosition="Top"
                                                    AnimationsSpeed="00:00:00.300"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!--  ROW 6: Métricas avanzadas + Distribución y Tiempo  -->
                    <Grid Grid.Row="6"
                          Margin="24,14,24,24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="Métricas Avanzadas"
                                           FontSize="14"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource ThemeFgB}"
                                           Margin="0,0,0,12"/>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Ganancia Promedio"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.AverageWin, StringFormat=${}{0:N2}}"
                                               Foreground="{DynamicResource ThemeWinTextB}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Pérdida Promedio"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.AverageLoss, StringFormat=-${}{0:N2}}"
                                               Foreground="{DynamicResource ThemeLossTextB}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Mayor Ganancia"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.LargestWin, StringFormat=${}{0:N2}}"
                                               Foreground="{DynamicResource ThemeWinTextB}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Mayor Pérdida"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.LargestLoss, StringFormat=${}{0:N2}}"
                                               Foreground="{DynamicResource ThemeLossTextB}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Border Height="1"
                                        Background="{DynamicResource ThemeStrokeB}"
                                        Margin="0,4,0,8"
                                        Opacity="0.5"/>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="PnL Bruto"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.GrossPnl, StringFormat=${}{0:N2}}"
                                               FontWeight="SemiBold"
                                               Foreground="{Binding Stats.GrossPnl, Converter={StaticResource PnlBrush}}"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Costos Totales"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.TotalFees, StringFormat=${}{0:N2}}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Esperanza (R)"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.ExpectancyR, StringFormat={}{0:0.0000}R}"
                                               FontWeight="SemiBold"
                                               Foreground="{Binding Stats.ExpectancyR, Converter={StaticResource PnlBrush}}"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="2"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="Distribución y Tiempo"
                                           FontSize="14"
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource ThemeFgB}"
                                           Margin="0,0,0,12"/>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Trades Largos"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               FontWeight="SemiBold">
                                        <Run Text="{Binding Stats.LongCount, Mode=OneWay}"/>
                                        <Run Text=" (TA: "/>
                                        <Run Text="{Binding Stats.LongWinRate, StringFormat={}{0:0.0}%, Mode=OneWay}"/>
                                        <Run Text=")"/>
                                    </TextBlock>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Trades Cortos"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               FontWeight="SemiBold">
                                        <Run Text="{Binding Stats.ShortCount, Mode=OneWay}"/>
                                        <Run Text=" (TA: "/>
                                        <Run Text="{Binding Stats.ShortWinRate, StringFormat={}{0:0.0}%, Mode=OneWay}"/>
                                        <Run Text=")"/>
                                    </TextBlock>
                                </Grid>
                                <Border Height="1"
                                        Background="{DynamicResource ThemeStrokeB}"
                                        Margin="0,4,0,8"
                                        Opacity="0.5"/>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Tiempo Prom. en Trade"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding AvgHoldTimeText}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Mayor Duración"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding LongestHoldText}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Menor Duración"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding ShortestHoldText}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Border Height="1"
                                        Background="{DynamicResource ThemeStrokeB}"
                                        Margin="0,4,0,8"
                                        Opacity="0.5"/>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Tasa Acierto (Largo)"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.LongWinRate, StringFormat={}{0:0.0}%}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Tasa Acierto (Corto)"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.ShortWinRate, StringFormat={}{0:0.0}%}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Grid>
            </ScrollViewer>

            <!--  PÁGINA: AJUSTES  -->
            <Grid Visibility="{Binding CurrentPage, Converter={StaticResource PageVis}, ConverterParameter=Settings}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel DataContext="{Binding Settings}"
                                Margin="24,16,24,24"
                                MaxWidth="900"
                                HorizontalAlignment="Left">
                        <TextBlock Text="⚙  Ajustes"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource ThemeFgB}"/>
                        <TextBlock Text="{Binding StatusText}"
                                   Foreground="{DynamicResource ThemeMutedB}"
                                   FontSize="11"
                                   Margin="0,3,0,20"/>

                        <!-- Toggle de Tema -->
                        <Border Style="{StaticResource Card}"
                                Margin="0,0,0,14">
                            <StackPanel>
                                <TextBlock Text="  Apariencia"
                                           Style="{StaticResource CardTitle}"/>
                                <CheckBox Content="  Modo Oscuro"
                                          IsChecked="{Binding IsDarkMode}"
                                          FontSize="13"/>
                            </StackPanel>
                        </Border>

                        <!-- Parámetros Dinámicos -->
                        <Border Style="{StaticResource Card}"
                                Margin="0,0,0,14">
                            <StackPanel>
                                <TextBlock Text="  Parámetros por Defecto"
                                           Style="{StaticResource CardTitle}"/>
                                <TextBlock Text="Estos valores se pre-llenan en el formulario. El usuario puede modificarlos manualmente."
                                           Foreground="{DynamicResource ThemeMutedB}"
                                           FontSize="10"
                                           Margin="0,-8,0,12"/>
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="12"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="12"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Setup por Defecto"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBox Text="{Binding DefaultSetup, UpdateSourceTrigger=PropertyChanged}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Estrategia por Defecto"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBox Text="{Binding DefaultStrategy, UpdateSourceTrigger=PropertyChanged}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="4">
                                        <TextBlock Text="Contexto por Defecto"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBox Text="{Binding DefaultContext, UpdateSourceTrigger=PropertyChanged}"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Temporalidades -->
                        <Border Style="{StaticResource Card}"
                                Margin="0,0,0,14">
                            <StackPanel>
                                <TextBlock Text="  Temporalidades"
                                           Style="{StaticResource CardTitle}"/>
                                <TextBlock Text="Define las temporalidades que analizas. El formulario genera campos automáticamente."
                                           Foreground="{DynamicResource ThemeMutedB}"
                                           FontSize="10"
                                           Margin="0,-8,0,12"/>
                                <Grid Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding NewTimeframe, UpdateSourceTrigger=PropertyChanged}"
                                             ToolTip="ej: 1H, 4H, D1"/>
                                    <Button Grid.Column="1"
                                            Content="➕ Agregar"
                                            Margin="8,0,0,0"
                                            Padding="14,7"
                                            Style="{StaticResource BtnGhost}"
                                            Command="{Binding AddTimeframeCommand}"/>
                                </Grid>
                                <ListBox ItemsSource="{Binding Timeframes}"
                                         SelectedItem="{Binding SelectedTimeframe}"
                                         MinHeight="36"
                                         MaxHeight="180">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border CornerRadius="6"
                                                    Background="{DynamicResource ThemeBg2B}"
                                                    Padding="10,5"
                                                    Margin="0,2">
                                                <TextBlock Text="{Binding}"
                                                           FontSize="13"
                                                           FontWeight="Bold"
                                                           Foreground="{DynamicResource ThemeCyanB}"/>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,8,0,0">
                                    <Button Content="⬆ Subir"
                                            Style="{StaticResource BtnGhost}"
                                            Padding="10,5"
                                            Margin="0,0,4,0"
                                            Command="{Binding MoveTimeframeUpCommand}"/>
                                    <Button Content="⬇ Bajar"
                                            Style="{StaticResource BtnGhost}"
                                            Padding="10,5"
                                            Margin="0,0,4,0"
                                            Command="{Binding MoveTimeframeDownCommand}"/>
                                    <Button Content="🗑 Eliminar"
                                            Style="{StaticResource BtnGhost}"
                                            Padding="10,5"
                                            Command="{Binding RemoveTimeframeCommand}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Reglas de Checklist -->
                        <Border Style="{StaticResource Card}"
                                Margin="0,0,0,14">
                            <StackPanel>
                                <TextBlock Text="✅  Reglas del Checklist"
                                           Style="{StaticResource CardTitle}"/>
                                <TextBlock Text="Define tu plan de trading. Las reglas activas aparecen al registrar operaciones."
                                           Foreground="{DynamicResource ThemeMutedB}"
                                           FontSize="10"
                                           Margin="0,-8,0,12"/>
                                <Border CornerRadius="8"
                                        Padding="14"
                                        Margin="0,0,0,12"
                                        Background="{DynamicResource ThemeBg0B}"
                                        BorderBrush="{DynamicResource ThemeStrokeB}"
                                        BorderThickness="1">
                                    <StackPanel>
                                        <TextBlock Text="NUEVA REGLA"
                                                   FontSize="9"
                                                   FontWeight="Bold"
                                                   Foreground="{DynamicResource ThemeAccentB}"
                                                   Margin="0,0,0,8"/>
                                        <Grid Margin="0,0,0,8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="10"/>
                                                <ColumnDefinition Width="140"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel>
                                                <TextBlock Text="Nombre"
                                                           Style="{StaticResource Lbl}"/>
                                                <TextBox Text="{Binding NewRuleName, UpdateSourceTrigger=PropertyChanged}"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2">
                                                <TextBlock Text="Categoría"
                                                           Style="{StaticResource Lbl}"/>
                                                <ComboBox Text="{Binding NewRuleCategory, UpdateSourceTrigger=PropertyChanged}"
                                                          ItemsSource="{Binding CategorySuggestions}"
                                                          IsEditable="True"/>
                                            </StackPanel>
                                        </Grid>
                                        <TextBlock Text="Descripción (opcional)"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBox Text="{Binding NewRuleDescription, UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8"/>
                                        <Button Content="➕ Agregar Regla"
                                                HorizontalAlignment="Left"
                                                Padding="14,7"
                                                Style="{StaticResource BtnPrimary}"
                                                Command="{Binding AddRuleCommand}"/>
                                    </StackPanel>
                                </Border>
                                <ListBox ItemsSource="{Binding ChecklistRules}"
                                         SelectedItem="{Binding SelectedRule}"
                                         MinHeight="36"
                                         MaxHeight="260">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border CornerRadius="6"
                                                    Background="{DynamicResource ThemeBg0B}"
                                                    Padding="10,8"
                                                    Margin="0,2"
                                                    BorderBrush="{DynamicResource ThemeStrokeB}"
                                                    BorderThickness="1">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Ellipse Width="7"
                                                             Height="7"
                                                             Margin="0,0,10,0"
                                                             VerticalAlignment="Center">
                                                        <Ellipse.Style>
                                                            <Style TargetType="Ellipse">
                                                                <Setter Property="Fill"
                                                                        Value="{DynamicResource ThemeWinTextB}"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsActive}"
                                                                                 Value="False">
                                                                        <Setter Property="Fill"
                                                                                Value="{DynamicResource ThemeMutedB}"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Ellipse.Style>
                                                    </Ellipse>
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="{Binding Name}"
                                                                   FontSize="12"
                                                                   FontWeight="SemiBold"
                                                                   Foreground="{DynamicResource ThemeFgB}"/>
                                                        <StackPanel Orientation="Horizontal"
                                                                    Margin="0,2,0,0">
                                                            <Border CornerRadius="3"
                                                                    Background="{DynamicResource ThemeBg2B}"
                                                                    Padding="5,1"
                                                                    Margin="0,0,5,0">
                                                                <TextBlock Text="{Binding Category}"
                                                                           FontSize="8"
                                                                           FontWeight="Bold"
                                                                           Foreground="{DynamicResource ThemeMutedB}"/>
                                                            </Border>
                                                            <TextBlock Text="{Binding Description}"
                                                                       FontSize="9"
                                                                       Foreground="{DynamicResource ThemeMutedB}"
                                                                       VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                    <TextBlock Grid.Column="2"
                                                               FontSize="9"
                                                               VerticalAlignment="Center"
                                                               Foreground="{DynamicResource ThemeMutedB}">
                                                        <Run Text="#"/>
                                                        <Run Text="{Binding SortOrder, Mode=OneWay}"/>
                                                    </TextBlock>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                                <!-- Edit selected -->
                                <Border CornerRadius="8"
                                        Padding="14"
                                        Margin="0,12,0,0"
                                        Background="{DynamicResource ThemeBg0B}"
                                        BorderBrush="{DynamicResource ThemeStrokeB}"
                                        BorderThickness="1"
                                        Visibility="{Binding SelectedRule, Converter={StaticResource NullVis}}">
                                    <StackPanel>
                                        <TextBlock Text="EDITAR SELECCIONADA"
                                                   FontSize="9"
                                                   FontWeight="Bold"
                                                   Foreground="{DynamicResource ThemeAmberB}"
                                                   Margin="0,0,0,8"/>
                                        <Grid Margin="0,0,0,8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="10"/>
                                                <ColumnDefinition Width="140"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel>
                                                <TextBlock Text="Nombre"
                                                           Style="{StaticResource Lbl}"/>
                                                <TextBox Text="{Binding EditRuleName, UpdateSourceTrigger=PropertyChanged}"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2">
                                                <TextBlock Text="Categoría"
                                                           Style="{StaticResource Lbl}"/>
                                                <ComboBox Text="{Binding EditRuleCategory, UpdateSourceTrigger=PropertyChanged}"
                                                          ItemsSource="{Binding CategorySuggestions}"
                                                          IsEditable="True"/>
                                            </StackPanel>
                                        </Grid>
                                        <TextBlock Text="Descripción"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBox Text="{Binding EditRuleDescription, UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,10"/>
                                        <StackPanel Orientation="Horizontal">
                                            <CheckBox Content="  Activa"
                                                      IsChecked="{Binding EditRuleIsActive}"
                                                      VerticalAlignment="Center"
                                                      Margin="0,0,14,0"/>
                                            <Button Content=" Guardar"
                                                    Style="{StaticResource BtnPrimary}"
                                                    Padding="12,6"
                                                    Margin="0,0,4,0"
                                                    Command="{Binding UpdateRuleCommand}"/>
                                            <Button Content=" Toggle"
                                                    Style="{StaticResource BtnGhost}"
                                                    Padding="10,6"
                                                    Margin="0,0,4,0"
                                                    Command="{Binding ToggleRuleCommand}"/>
                                            <Button Content="🗑 Eliminar"
                                                    Style="{StaticResource BtnGhost}"
                                                    Padding="10,6"
                                                    Command="{Binding DeleteRuleCommand}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>

                        <!-- Preferencias -->
                        <Border Style="{StaticResource Card}"
                                Margin="0,0,0,14">
                            <StackPanel>
                                <TextBlock Text="  Preferencias"
                                           Style="{StaticResource CardTitle}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition Width="12"/>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="12"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Riesgo por Defecto %"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBox Text="{Binding DefaultRiskPercent, StringFormat={}{0:0.##}}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Balance de Cuenta"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBox Text="{Binding DefaultAccountBalance, TargetNullValue='', StringFormat={}{0:0.##}}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="4">
                                        <TextBlock Text="Moneda"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBox Text="{Binding BaseCurrency, UpdateSourceTrigger=PropertyChanged}"/>
                                    </StackPanel>
                                </Grid>
                                <Button Content=" Guardar Preferencias"
                                        HorizontalAlignment="Left"
                                        Margin="0,14,0,0"
                                        Padding="16,8"
                                        Style="{StaticResource BtnPrimary}"
                                        Command="{Binding SavePreferencesCommand}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>

        </Grid>
    </Grid>
</Window>

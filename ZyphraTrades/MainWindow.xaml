<Window x:Class="ZyphraTrades.Presentation.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:ZyphraTrades.Presentation.Converters"
        Title="ZyphraTrades"
        Height="820"
        Width="1380"
        WindowStartupLocation="CenterScreen"
        Background="#06060A"
        Foreground="#E8E8F0">

    <Window.Resources>
        <Color x:Key="Bg0">#06060A</Color>
        <Color x:Key="Bg1">#0B0B12</Color>
        <Color x:Key="Bg2">#10111A</Color>
        <Color x:Key="Bg3">#161822</Color>
        <Color x:Key="Stroke">#1E2035</Color>
        <Color x:Key="StrokeLight">#2A2D48</Color>
        <Color x:Key="Muted">#7B7FA0</Color>
        <Color x:Key="Accent">#E11D48</Color>
        <Color x:Key="AccentGlow">#FF2D5A</Color>
        <Color x:Key="Cyan">#06B6D4</Color>
        <Color x:Key="Green">#10B981</Color>
        <Color x:Key="Amber">#F59E0B</Color>
        <Color x:Key="Purple">#8B5CF6</Color>

        <SolidColorBrush x:Key="Bg0B"
                         Color="{StaticResource Bg0}"/>
        <SolidColorBrush x:Key="Bg1B"
                         Color="{StaticResource Bg1}"/>
        <SolidColorBrush x:Key="Bg2B"
                         Color="{StaticResource Bg2}"/>
        <SolidColorBrush x:Key="Bg3B"
                         Color="{StaticResource Bg3}"/>
        <SolidColorBrush x:Key="StrokeB"
                         Color="{StaticResource Stroke}"/>
        <SolidColorBrush x:Key="StrokeLightB"
                         Color="{StaticResource StrokeLight}"/>
        <SolidColorBrush x:Key="MutedB"
                         Color="{StaticResource Muted}"/>
        <SolidColorBrush x:Key="AccentB"
                         Color="{StaticResource Accent}"/>
        <SolidColorBrush x:Key="AccentGlowB"
                         Color="{StaticResource AccentGlow}"/>
        <SolidColorBrush x:Key="CyanB"
                         Color="{StaticResource Cyan}"/>
        <SolidColorBrush x:Key="GreenB"
                         Color="{StaticResource Green}"/>
        <SolidColorBrush x:Key="AmberB"
                         Color="{StaticResource Amber}"/>
        <SolidColorBrush x:Key="PurpleB"
                         Color="{StaticResource Purple}"/>

        <conv:PageToVisibilityConverter x:Key="PageVis"/>
        <conv:PnlToBrushConverter       x:Key="PnlBrush"/>
        <conv:SideToBrushConverter      x:Key="SideBrush"/>
        <conv:RatingToStarsConverter    x:Key="Stars"/>
        <conv:NullToVisibilityConverter x:Key="NullVis"/>

        <Style TargetType="TextBlock">
            <Setter Property="FontFamily"
                    Value="Segoe UI"/>
        </Style>

        <!-- ═══ CARD ═══ -->
        <Style x:Key="Card"
               TargetType="Border">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0"
                                         EndPoint="1,1">
                        <GradientStop Color="#0D0E18"
                                      Offset="0"/>
                        <GradientStop Color="#12131F"
                                      Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderBrush"
                    Value="{StaticResource StrokeB}"/>
            <Setter Property="BorderThickness"
                    Value="1"/>
            <Setter Property="CornerRadius"
                    Value="14"/>
            <Setter Property="Padding"
                    Value="20"/>
            <Setter Property="SnapsToDevicePixels"
                    Value="True"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="20"
                                      ShadowDepth="0"
                                      Opacity="0.15"
                                      Color="#000000"/>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="CardAccent"
               TargetType="Border"
               BasedOn="{StaticResource Card}">
            <Setter Property="BorderBrush">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0"
                                         EndPoint="1,1">
                        <GradientStop Color="#3A0F1E"
                                      Offset="0"/>
                        <GradientStop Color="#1E0A12"
                                      Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0"
                                         EndPoint="1,1">
                        <GradientStop Color="#120810"
                                      Offset="0"/>
                        <GradientStop Color="#0E0B14"
                                      Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="CardCyan"
               TargetType="Border"
               BasedOn="{StaticResource Card}">
            <Setter Property="BorderBrush">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0"
                                         EndPoint="1,1">
                        <GradientStop Color="#0A2A30"
                                      Offset="0"/>
                        <GradientStop Color="#0A1520"
                                      Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0"
                                         EndPoint="1,1">
                        <GradientStop Color="#080D16"
                                      Offset="0"/>
                        <GradientStop Color="#0A1018"
                                      Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ═══ PRIMARY BUTTON ═══ -->
        <Style x:Key="BtnPrimary"
               TargetType="Button">
            <Setter Property="Padding"
                    Value="18,10"/>
            <Setter Property="FontSize"
                    Value="12"/>
            <Setter Property="FontWeight"
                    Value="SemiBold"/>
            <Setter Property="Cursor"
                    Value="Hand"/>
            <Setter Property="Foreground"
                    Value="#FFFFFF"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}"
                                SnapsToDevicePixels="True">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0"
                                                     EndPoint="1,1">
                                    <GradientStop Color="#C41838"
                                                  Offset="0"/>
                                    <GradientStop Color="#8B0E2A"
                                                  Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="18"
                                                  ShadowDepth="0"
                                                  Opacity="0.35"
                                                  Color="#E11D48"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0"
                                                             EndPoint="1,1">
                                            <GradientStop Color="#E11D48"
                                                          Offset="0"/>
                                            <GradientStop Color="#A01030"
                                                          Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background">
                                    <Setter.Value>
                                        <SolidColorBrush Color="#7A0C22"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled"
                                     Value="False">
                                <Setter Property="Opacity"
                                        Value="0.35"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ═══ GHOST BUTTON ═══ -->
        <Style x:Key="BtnGhost"
               TargetType="Button">
            <Setter Property="Padding"
                    Value="14,9"/>
            <Setter Property="FontSize"
                    Value="12"/>
            <Setter Property="FontWeight"
                    Value="SemiBold"/>
            <Setter Property="Cursor"
                    Value="Hand"/>
            <Setter Property="Foreground"
                    Value="#C8C8D8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}"
                                Background="{StaticResource Bg2B}"
                                BorderBrush="{StaticResource StrokeB}"
                                BorderThickness="1"
                                SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="#181A28"/>
                                <Setter TargetName="Bd"
                                        Property="BorderBrush"
                                        Value="{StaticResource StrokeLightB}"/>
                            </Trigger>
                            <Trigger Property="IsPressed"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="#0E0F18"/>
                            </Trigger>
                            <Trigger Property="IsEnabled"
                                     Value="False">
                                <Setter Property="Opacity"
                                        Value="0.30"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ═══ NAV ITEM ═══ -->
        <Style x:Key="NavItem"
               TargetType="Button">
            <Setter Property="HorizontalContentAlignment"
                    Value="Left"/>
            <Setter Property="Padding"
                    Value="14,11"/>
            <Setter Property="Margin"
                    Value="0,2"/>
            <Setter Property="FontSize"
                    Value="13"/>
            <Setter Property="Cursor"
                    Value="Hand"/>
            <Setter Property="Foreground"
                    Value="{StaticResource MutedB}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}"
                                Background="Transparent"
                                SnapsToDevicePixels="True">
                            <ContentPresenter VerticalAlignment="Center"
                                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="#12131E"/>
                                <Setter Property="Foreground"
                                        Value="#D0D0E0"/>
                            </Trigger>
                            <Trigger Property="Tag"
                                     Value="Active">
                                <Setter TargetName="Bd"
                                        Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0.5"
                                                             EndPoint="1,0.5">
                                            <GradientStop Color="#1C0A14"
                                                          Offset="0"/>
                                            <GradientStop Color="#10111C"
                                                          Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="Foreground"
                                        Value="#FFFFFF"/>
                                <Setter Property="FontWeight"
                                        Value="SemiBold"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ═══ TEXTBOX (full dark template) ═══ -->
        <Style TargetType="TextBox">
            <Setter Property="Foreground"
                    Value="#E0E0F0"/>
            <Setter Property="CaretBrush"
                    Value="{StaticResource CyanB}"/>
            <Setter Property="SelectionBrush"
                    Value="{StaticResource AccentB}"/>
            <Setter Property="FontSize"
                    Value="13"/>
            <Setter Property="SnapsToDevicePixels"
                    Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="Bd"
                                Background="#0A0B14"
                                BorderBrush="{StaticResource StrokeB}"
                                BorderThickness="1"
                                CornerRadius="6"
                                Padding="10,9"
                                SnapsToDevicePixels="True">
                            <ScrollViewer x:Name="PART_ContentHost"
                                          Focusable="False"
                                          HorizontalScrollBarVisibility="Hidden"
                                          VerticalScrollBarVisibility="Hidden"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="BorderBrush"
                                        Value="{StaticResource StrokeLightB}"/>
                            </Trigger>
                            <Trigger Property="IsFocused"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="BorderBrush"
                                        Value="{StaticResource CyanB}"/>
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="#0C0D18"/>
                            </Trigger>
                            <Trigger Property="IsEnabled"
                                     Value="False">
                                <Setter Property="Opacity"
                                        Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ═══ COMBOBOX (full dark template) ═══ -->
        <ControlTemplate x:Key="ComboBoxToggleButton"
                         TargetType="ToggleButton">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="28"/>
                </Grid.ColumnDefinitions>
                <Border x:Name="Bd"
                        Grid.ColumnSpan="2"
                        Background="#0A0B14"
                        BorderBrush="{StaticResource StrokeB}"
                        BorderThickness="1"
                        CornerRadius="6"
                        SnapsToDevicePixels="True"/>
                <Border Grid.Column="0"
                        Background="Transparent"
                        CornerRadius="6,0,0,6"
                        Margin="1"/>
                <Path x:Name="Arrow"
                      Grid.Column="1"
                      Data="M 0 0 L 4 4 L 8 0 Z"
                      Fill="{StaticResource MutedB}"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"/>
            </Grid>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver"
                         Value="True">
                    <Setter TargetName="Bd"
                            Property="BorderBrush"
                            Value="{StaticResource StrokeLightB}"/>
                    <Setter TargetName="Arrow"
                            Property="Fill"
                            Value="#E0E0F0"/>
                </Trigger>
                <Trigger Property="IsChecked"
                         Value="True">
                    <Setter TargetName="Bd"
                            Property="BorderBrush"
                            Value="{StaticResource CyanB}"/>
                    <Setter TargetName="Bd"
                            Property="Background"
                            Value="#0C0D18"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
        <ControlTemplate x:Key="ComboBoxTextBox"
                         TargetType="TextBox">
            <Border x:Name="PART_ContentHost"
                    Focusable="False"
                    Background="Transparent"/>
        </ControlTemplate>
        <Style TargetType="ComboBox">
            <Setter Property="Foreground"
                    Value="#E0E0F0"/>
            <Setter Property="FontSize"
                    Value="13"/>
            <Setter Property="SnapsToDevicePixels"
                    Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton x:Name="ToggleButton"
                                          Template="{StaticResource ComboBoxToggleButton}"
                                          Focusable="False"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press"/>
                            <ContentPresenter x:Name="ContentSite"
                                              IsHitTestVisible="False"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                              Margin="10,8,28,8"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Left"/>
                            <TextBox x:Name="PART_EditableTextBox"
                                     Template="{StaticResource ComboBoxTextBox}"
                                     HorizontalAlignment="Left"
                                     VerticalAlignment="Center"
                                     Margin="10,8,28,8"
                                     Focusable="True"
                                     Background="Transparent"
                                     Foreground="#E0E0F0"
                                     CaretBrush="{StaticResource CyanB}"
                                     Visibility="Hidden"
                                     IsReadOnly="{TemplateBinding IsReadOnly}"/>
                            <Popup x:Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Grid x:Name="DropDown"
                                      SnapsToDevicePixels="True"
                                      MinWidth="{TemplateBinding ActualWidth}"
                                      MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border x:Name="DropDownBorder"
                                            Background="#0C0D18"
                                            BorderBrush="{StaticResource StrokeLightB}"
                                            BorderThickness="1"
                                            CornerRadius="6"
                                            Margin="0,2,0,0">
                                        <Border.Effect>
                                            <DropShadowEffect BlurRadius="12"
                                                              ShadowDepth="4"
                                                              Opacity="0.4"
                                                              Color="#000000"/>
                                        </Border.Effect>
                                    </Border>
                                    <ScrollViewer Margin="4,6"
                                                  SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True"
                                                    KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Grid>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="HasItems"
                                     Value="False">
                                <Setter TargetName="DropDownBorder"
                                        Property="MinHeight"
                                        Value="95"/>
                            </Trigger>
                            <Trigger Property="IsEditable"
                                     Value="True">
                                <Setter Property="IsTabStop"
                                        Value="False"/>
                                <Setter TargetName="PART_EditableTextBox"
                                        Property="Visibility"
                                        Value="Visible"/>
                                <Setter TargetName="ContentSite"
                                        Property="Visibility"
                                        Value="Hidden"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="ComboBoxItem">
            <Setter Property="Foreground"
                    Value="#D0D0E0"/>
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="Padding"
                    Value="10,7"/>
            <Setter Property="FontSize"
                    Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBoxItem">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="4"
                                Margin="2,1">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="#161828"/>
                            </Trigger>
                            <Trigger Property="IsSelected"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="#1A0C16"/>
                                <Setter Property="Foreground"
                                        Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ═══ DATEPICKER (full dark template) ═══ -->
        <Style TargetType="DatePickerTextBox">
            <Setter Property="Foreground"
                    Value="#E0E0F0"/>
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DatePickerTextBox">
                        <ScrollViewer x:Name="PART_ContentHost"
                                      Focusable="False"
                                      HorizontalScrollBarVisibility="Hidden"
                                      VerticalScrollBarVisibility="Hidden"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="DatePicker">
            <Setter Property="Foreground"
                    Value="#E0E0F0"/>
            <Setter Property="FontSize"
                    Value="13"/>
            <Setter Property="CalendarStyle">
                <Setter.Value>
                    <Style TargetType="Calendar">
                        <Setter Property="Background"
                                Value="#0C0D18"/>
                        <Setter Property="Foreground"
                                Value="#E0E0F0"/>
                        <Setter Property="BorderBrush"
                                Value="{StaticResource StrokeLightB}"/>
                    </Style>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DatePicker">
                        <Border x:Name="Bd"
                                Background="#0A0B14"
                                BorderBrush="{StaticResource StrokeB}"
                                BorderThickness="1"
                                CornerRadius="6"
                                Padding="8,7"
                                SnapsToDevicePixels="True">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <DatePickerTextBox x:Name="PART_TextBox"
                                                   Foreground="#E0E0F0"
                                                   VerticalAlignment="Center"
                                                   HorizontalAlignment="Stretch"/>
                                <Button x:Name="PART_Button"
                                        Grid.Column="1"
                                        Foreground="{StaticResource MutedB}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Padding="4,0,0,0"
                                        Cursor="Hand"
                                        VerticalAlignment="Center">
                                    <Path Data="M 0,0 H12 V12 H0 Z M 0,3 H12 M 3,0 V3 M 9,0 V3"
                                          Stroke="{StaticResource MutedB}"
                                          StrokeThickness="1.2"
                                          Width="14"
                                          Height="14"/>
                                </Button>
                                <Popup x:Name="PART_Popup"
                                       PlacementTarget="{Binding ElementName=Bd}"
                                       Placement="Bottom"
                                       AllowsTransparency="True"
                                       StaysOpen="False">
                                    <Border Background="#0C0D18"
                                            BorderBrush="{StaticResource StrokeLightB}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="4"
                                            Margin="0,2,0,0">
                                        <Border.Effect>
                                            <DropShadowEffect BlurRadius="12"
                                                              ShadowDepth="4"
                                                              Opacity="0.4"
                                                              Color="#000000"/>
                                        </Border.Effect>
                                        <Calendar x:Name="PART_Calendar"/>
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="BorderBrush"
                                        Value="{StaticResource StrokeLightB}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled"
                                     Value="False">
                                <Setter Property="Opacity"
                                        Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ═══ CHECKBOX (dark template) ═══ -->
        <Style TargetType="CheckBox">
            <Setter Property="Foreground"
                    Value="#C8C8D8"/>
            <Setter Property="FontSize"
                    Value="12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <StackPanel Orientation="Horizontal">
                            <Border x:Name="Box"
                                    Width="18"
                                    Height="18"
                                    CornerRadius="4"
                                    Background="#0A0B14"
                                    BorderBrush="{StaticResource StrokeB}"
                                    BorderThickness="1.5"
                                    SnapsToDevicePixels="True">
                                <Path x:Name="Check"
                                      Data="M 3,8 L 7,12 L 13,4"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      Visibility="Collapsed"
                                      Margin="-1,-1,0,0"/>
                            </Border>
                            <ContentPresenter Margin="6,0,0,0"
                                              VerticalAlignment="Center"/>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked"
                                     Value="True">
                                <Setter TargetName="Box"
                                        Property="Background"
                                        Value="{StaticResource AccentB}"/>
                                <Setter TargetName="Box"
                                        Property="BorderBrush"
                                        Value="{StaticResource AccentB}"/>
                                <Setter TargetName="Check"
                                        Property="Visibility"
                                        Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Box"
                                        Property="BorderBrush"
                                        Value="{StaticResource StrokeLightB}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ═══ LISTBOX (dark) ═══ -->
        <Style TargetType="ListBox">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="BorderThickness"
                    Value="0"/>
            <Setter Property="Foreground"
                    Value="#E0E0F0"/>
        </Style>
        <Style TargetType="ListBoxItem">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="Foreground"
                    Value="#E0E0F0"/>
            <Setter Property="Padding"
                    Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected"
                                     Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="#12131F"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ═══ SCROLLBAR (dark) ═══ -->
        <Style x:Key="ScrollBarThumb"
                TargetType="Thumb">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Thumb">
                        <Border Background="#2A2D48"
                                CornerRadius="4"
                                Margin="1"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="ScrollBarLineButton"
                TargetType="RepeatButton">
            <Setter Property="Visibility"
                    Value="Collapsed"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RepeatButton">
                        <Border Background="Transparent"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="ScrollBarPageButton"
                TargetType="RepeatButton">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RepeatButton">
                        <Border Background="Transparent"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="ScrollBar">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="Width"
                    Value="10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid Background="Transparent">
                            <Track x:Name="PART_Track"
                                    IsDirectionReversed="True">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Style="{StaticResource ScrollBarPageButton}"
                                            Command="ScrollBar.PageUpCommand"/>
                                </Track.DecreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb Style="{StaticResource ScrollBarThumb}"/>
                                </Track.Thumb>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Style="{StaticResource ScrollBarPageButton}"
                                            Command="ScrollBar.PageDownCommand"/>
                                </Track.IncreaseRepeatButton>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="Orientation"
                        Value="Horizontal">
                    <Setter Property="Height"
                            Value="10"/>
                    <Setter Property="Width"
                            Value="Auto"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ScrollBar">
                                <Grid Background="Transparent">
                                    <Track x:Name="PART_Track"
                                            IsDirectionReversed="False">
                                        <Track.DecreaseRepeatButton>
                                            <RepeatButton Style="{StaticResource ScrollBarPageButton}"
                                                    Command="ScrollBar.PageLeftCommand"/>
                                        </Track.DecreaseRepeatButton>
                                        <Track.Thumb>
                                            <Thumb Style="{StaticResource ScrollBarThumb}"/>
                                        </Track.Thumb>
                                        <Track.IncreaseRepeatButton>
                                            <RepeatButton Style="{StaticResource ScrollBarPageButton}"
                                                    Command="ScrollBar.PageRightCommand"/>
                                        </Track.IncreaseRepeatButton>
                                    </Track>
                                </Grid>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- ═══ DATAGRID (full dark) ═══ -->
        <Style TargetType="DataGrid">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="Foreground"
                    Value="#D8D8E8"/>
            <Setter Property="BorderThickness"
                    Value="0"/>
            <Setter Property="RowBackground"
                    Value="Transparent"/>
            <Setter Property="AlternatingRowBackground"
                    Value="#0A0B14"/>
            <Setter Property="GridLinesVisibility"
                    Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush"
                    Value="#0F1020"/>
            <Setter Property="HeadersVisibility"
                    Value="Column"/>
            <Setter Property="RowHeight"
                    Value="42"/>
            <Setter Property="ColumnHeaderHeight"
                    Value="40"/>
            <Setter Property="CanUserAddRows"
                    Value="False"/>
            <Setter Property="CanUserResizeRows"
                    Value="False"/>
            <Setter Property="SelectionMode"
                    Value="Single"/>
            <Setter Property="SelectionUnit"
                    Value="FullRow"/>
            <Setter Property="AutoGenerateColumns"
                    Value="False"/>
            <Setter Property="IsReadOnly"
                    Value="True"/>
            <Setter Property="FontSize"
                    Value="12"/>
        </Style>
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background"
                    Value="#080910"/>
            <Setter Property="Foreground"
                    Value="{StaticResource MutedB}"/>
            <Setter Property="FontWeight"
                    Value="Bold"/>
            <Setter Property="FontSize"
                    Value="10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridColumnHeader">
                        <Border Background="#080910"
                                BorderBrush="{StaticResource StrokeB}"
                                BorderThickness="0,0,0,1"
                                Padding="12,0">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="DataGridCell">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="BorderThickness"
                    Value="0"/>
            <Setter Property="Foreground"
                    Value="#D0D0E0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <Border x:Name="Bd"
                                Background="Transparent"
                                Padding="12,0"
                                SnapsToDevicePixels="True">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected"
                                    Value="True">
                                <Setter TargetName="Bd"
                                        Property="Background"
                                        Value="Transparent"/>
                                <Setter Property="Foreground"
                                        Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="DataGridRow">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="BorderThickness"
                    Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridRow">
                        <Border x:Name="DGR_Border"
                                Background="{TemplateBinding Background}"
                                BorderThickness="0"
                                SnapsToDevicePixels="True">
                            <SelectiveScrollingGrid>
                                <SelectiveScrollingGrid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </SelectiveScrollingGrid.ColumnDefinitions>
                                <SelectiveScrollingGrid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </SelectiveScrollingGrid.RowDefinitions>
                                <DataGridCellsPresenter Grid.Column="1"
                                        ItemsPanel="{TemplateBinding ItemsPanel}"
                                        SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                <DataGridDetailsPresenter Grid.Column="1"
                                        Grid.Row="1"
                                        SelectiveScrollingGrid.SelectiveScrollingOrientation="{Binding AreRowDetailsFrozen, ConverterParameter={x:Static SelectiveScrollingOrientation.Vertical}, Converter={x:Static DataGrid.RowDetailsScrollingConverter}, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"
                                        Visibility="{TemplateBinding DetailsVisibility}"/>
                                <DataGridRowHeader Grid.RowSpan="2"
                                        SelectiveScrollingGrid.SelectiveScrollingOrientation="Vertical"
                                        Visibility="{Binding HeadersVisibility, ConverterParameter={x:Static DataGridHeadersVisibility.Row}, Converter={x:Static DataGrid.HeadersVisibilityConverter}, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"/>
                            </SelectiveScrollingGrid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                    Value="True">
                                <Setter TargetName="DGR_Border"
                                        Property="Background"
                                        Value="#12131E"/>
                            </Trigger>
                            <Trigger Property="IsSelected"
                                    Value="True">
                                <Setter TargetName="DGR_Border"
                                        Property="Background"
                                        Value="#1A0C16"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="DataGridRowHeader">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="BorderThickness"
                    Value="0"/>
            <Setter Property="Width"
                    Value="0"/>
        </Style>

        <Style x:Key="Lbl"
               TargetType="TextBlock">
            <Setter Property="Foreground"
                    Value="{StaticResource MutedB}"/>
            <Setter Property="FontSize"
                    Value="11"/>
            <Setter Property="FontWeight"
                    Value="Medium"/>
            <Setter Property="Margin"
                    Value="0,0,0,5"/>
        </Style>
        <Style x:Key="CardTitle"
               TargetType="TextBlock">
            <Setter Property="FontSize"
                    Value="14"/>
            <Setter Property="FontWeight"
                    Value="Bold"/>
            <Setter Property="Foreground"
                    Value="#F0F0FF"/>
            <Setter Property="Margin"
                    Value="0,0,0,16"/>
        </Style>
        <Style x:Key="KpiValue"
               TargetType="TextBlock">
            <Setter Property="FontSize"
                    Value="28"/>
            <Setter Property="FontWeight"
                    Value="Bold"/>
            <Setter Property="Margin"
                    Value="0,6,0,0"/>
        </Style>
        <Style x:Key="KpiLabel"
               TargetType="TextBlock">
            <Setter Property="Foreground"
                    Value="{StaticResource MutedB}"/>
            <Setter Property="FontSize"
                    Value="10"/>
            <Setter Property="FontWeight"
                    Value="Bold"/>
        </Style>
        <Style x:Key="KpiSub"
               TargetType="TextBlock">
            <Setter Property="Foreground"
                    Value="{StaticResource MutedB}"/>
            <Setter Property="FontSize"
                    Value="11"/>
            <Setter Property="Margin"
                    Value="0,4,0,0"/>
        </Style>
        <Style x:Key="MRow"
               TargetType="Grid">
            <Setter Property="Margin"
                    Value="0,0,0,10"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ═══════════ SIDEBAR ═══════════ -->
        <Border Grid.Column="0"
                BorderThickness="0,0,1,0"
                BorderBrush="{StaticResource StrokeB}">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0"
                                     EndPoint="0,1">
                    <GradientStop Color="#0A0B14"
                                  Offset="0"/>
                    <GradientStop Color="#080912"
                                  Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <DockPanel Margin="18,20,18,18">
                <StackPanel DockPanel.Dock="Top">
                    <StackPanel Orientation="Horizontal"
                                Margin="0,0,0,2">
                        <TextBlock Text="&#x26A1;"
                                   FontSize="22"
                                   Margin="0,0,8,0"/>
                        <TextBlock Text="ZyphraTrades"
                                   FontSize="19"
                                   FontWeight="Bold"
                                   Foreground="White"/>
                    </StackPanel>
                    <TextBlock Text="Precision Trading Journal"
                               Foreground="{StaticResource MutedB}"
                               FontSize="10"
                               FontWeight="Medium"
                               Margin="0,2,0,0"/>
                    <Border Height="1"
                            Margin="0,18,0,6">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0.5"
                                                 EndPoint="1,0.5">
                                <GradientStop Color="#2A0E18"
                                              Offset="0"/>
                                <GradientStop Color="#1E2035"
                                              Offset="0.5"/>
                                <GradientStop Color="#0A1520"
                                              Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                    </Border>
                </StackPanel>

                <StackPanel DockPanel.Dock="Top"
                            Margin="0,8,0,0">
                    <TextBlock Text="TRADE"
                               Foreground="{StaticResource MutedB}"
                               FontSize="9"
                               FontWeight="Bold"
                               Margin="14,0,0,6"
                               Opacity="0.6"/>
                    <Button Content="&#x2795;  New Trade"
                            Command="{Binding NavigateCommand}"
                            CommandParameter="AddTrade">
                        <Button.Style>
                            <Style TargetType="Button"
                                   BasedOn="{StaticResource NavItem}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentPage}"
                                                 Value="AddTrade">
                                        <Setter Property="Tag"
                                                Value="Active"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                    <Button Content="&#x1F4CB;  Trade Log"
                            Command="{Binding NavigateCommand}"
                            CommandParameter="Trades">
                        <Button.Style>
                            <Style TargetType="Button"
                                   BasedOn="{StaticResource NavItem}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentPage}"
                                                 Value="Trades">
                                        <Setter Property="Tag"
                                                Value="Active"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                    <Border Height="1"
                            Background="{StaticResource StrokeB}"
                            Margin="0,12,0,12"
                            Opacity="0.5"/>
                    <TextBlock Text="ANALYTICS"
                               Foreground="{StaticResource MutedB}"
                               FontSize="9"
                               FontWeight="Bold"
                               Margin="14,0,0,6"
                               Opacity="0.6"/>
                    <Button Content="&#x1F4CA;  Dashboard"
                            Command="{Binding NavigateCommand}"
                            CommandParameter="Dashboard">
                        <Button.Style>
                            <Style TargetType="Button"
                                   BasedOn="{StaticResource NavItem}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentPage}"
                                                 Value="Dashboard">
                                        <Setter Property="Tag"
                                                Value="Active"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                    <Border Height="1"
                            Background="{StaticResource StrokeB}"
                            Margin="0,12,0,12"
                            Opacity="0.5"/>
                    <TextBlock Text="SYSTEM"
                               Foreground="{StaticResource MutedB}"
                               FontSize="9"
                               FontWeight="Bold"
                               Margin="14,0,0,6"
                               Opacity="0.6"/>
                    <Button Content="&#x2699;&#xFE0F;  Settings"
                            Command="{Binding NavigateCommand}"
                            CommandParameter="Settings">
                        <Button.Style>
                            <Style TargetType="Button"
                                   BasedOn="{StaticResource NavItem}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentPage}"
                                                 Value="Settings">
                                        <Setter Property="Tag"
                                                Value="Active"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>

                <StackPanel DockPanel.Dock="Bottom"
                            VerticalAlignment="Bottom">
                    <Border Height="1"
                            Margin="0,14,0,14"
                            Opacity="0.4">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0.5"
                                                 EndPoint="1,0.5">
                                <GradientStop Color="#1E2035"
                                              Offset="0"/>
                                <GradientStop Color="#0A1520"
                                              Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                    </Border>
                    <TextBlock Text="STATUS"
                               Foreground="{StaticResource MutedB}"
                               FontSize="9"
                               FontWeight="Bold"
                               Opacity="0.5"/>
                    <TextBlock Text="{Binding StatusText}"
                               FontSize="11"
                               Margin="0,4,0,0"
                               TextWrapping="Wrap"
                               Foreground="#9090A8"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- ═══════════ CONTENT ═══════════ -->
        <Grid Grid.Column="1"
              Background="{StaticResource Bg0B}">

            <!-- ══════ PAGE: ADD/EDIT TRADE ══════ -->
            <Grid Visibility="{Binding CurrentPage, Converter={StaticResource PageVis}, ConverterParameter=AddTrade}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Border Grid.Row="0"
                        BorderThickness="0,0,0,1"
                        BorderBrush="{StaticResource StrokeB}">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0"
                                             EndPoint="1,0">
                            <GradientStop Color="#0A0B14"
                                          Offset="0"/>
                            <GradientStop Color="#10080E"
                                          Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <Grid Margin="28,16">
                        <StackPanel>
                            <TextBlock Text="{Binding TradeForm.FormTitle}"
                                       FontSize="20"
                                       FontWeight="Bold"
                                       Foreground="White"/>
                            <TextBlock Text="Fill in all trade details for accurate journaling"
                                       Foreground="{StaticResource MutedB}"
                                       FontSize="11"
                                       Margin="0,3,0,0"/>
                        </StackPanel>
                        <StackPanel HorizontalAlignment="Right"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center">
                            <Button Style="{StaticResource BtnGhost}"
                                    Content="&#x21BA; Reset"
                                    Margin="0,0,10,0"
                                    Command="{Binding TradeForm.ResetCommand}"/>
                            <Button Style="{StaticResource BtnPrimary}"
                                    Content="&#x1F4BE;  Save Trade"
                                    Command="{Binding TradeForm.SaveCommand}"/>
                        </StackPanel>
                    </Grid>
                </Border>
                <ScrollViewer Grid.Row="1"
                              VerticalScrollBarVisibility="Auto">
                    <Grid Margin="28,20,28,28">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="16"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="16"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="16"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="16"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="16"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="16"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="16"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Basic Info -->
                        <Border Grid.Row="0"
                                Grid.Column="0"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="&#x1F4CC;  Basic Information"
                                           Style="{StaticResource CardTitle}"/>
                                <TextBlock Text="Symbol"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.Symbol, UpdateSourceTrigger=PropertyChanged}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Side"
                                           Style="{StaticResource Lbl}"/>
                                <ComboBox ItemsSource="{Binding TradeForm.SideOptions}"
                                          SelectedItem="{Binding TradeForm.SelectedSide}"
                                          Margin="0,0,0,12"/>
                                <TextBlock Text="Timeframe"
                                           Style="{StaticResource Lbl}"/>
                                <ComboBox ItemsSource="{Binding TradeForm.TimeframeOptions}"
                                          SelectedItem="{Binding TradeForm.SelectedTimeframe}"
                                          Margin="0,0,0,12"/>
                                <TextBlock Text="Status"
                                           Style="{StaticResource Lbl}"/>
                                <ComboBox ItemsSource="{Binding TradeForm.StatusOptions}"
                                          SelectedItem="{Binding TradeForm.SelectedStatus}"
                                          Margin="0,0,0,12"/>
                                <TextBlock Text="Session"
                                           Style="{StaticResource Lbl}"/>
                                <ComboBox ItemsSource="{Binding TradeForm.SessionOptions}"
                                          SelectedItem="{Binding TradeForm.SelectedSession}"
                                          Margin="0,0,0,12"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="12"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Open Date"
                                                   Style="{StaticResource Lbl}"/>
                                        <DatePicker SelectedDate="{Binding TradeForm.OpenDate}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Close Date"
                                                   Style="{StaticResource Lbl}"/>
                                        <DatePicker SelectedDate="{Binding TradeForm.CloseDate}"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Prices -->
                        <Border Grid.Row="0"
                                Grid.Column="2"
                                Style="{StaticResource CardCyan}">
                            <StackPanel>
                                <TextBlock Text="&#x1F4B2;  Prices &amp; Levels"
                                           Style="{StaticResource CardTitle}"/>
                                <TextBlock Text="Entry Price"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.EntryPrice, TargetNullValue='', StringFormat={}{0:0.######}}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Exit Price"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.ExitPrice, TargetNullValue='', StringFormat={}{0:0.######}}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Stop Loss"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.StopLoss, TargetNullValue='', StringFormat={}{0:0.######}}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Take Profit"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.TakeProfit, TargetNullValue='', StringFormat={}{0:0.######}}"
                                         Margin="0,0,0,14"/>
                                <Border Height="1"
                                        Margin="0,0,0,14">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0.5"
                                                             EndPoint="1,0.5">
                                            <GradientStop Color="#0A2A30"
                                                          Offset="0"/>
                                            <GradientStop Color="#1E2035"
                                                          Offset="0.5"/>
                                            <GradientStop Color="#0A2A30"
                                                          Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                </Border>
                                <TextBlock Text="Risk : Reward (auto)"
                                           Style="{StaticResource Lbl}"/>
                                <TextBlock Text="{Binding TradeForm.RiskRewardDisplay, StringFormat=1 : {0:0.00}, TargetNullValue='--'}"
                                           FontSize="22"
                                           FontWeight="Bold"
                                           Foreground="{StaticResource CyanB}"/>
                            </StackPanel>
                        </Border>

                        <!-- Position & Costs -->
                        <Border Grid.Row="2"
                                Grid.Column="0"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="&#x1F4D0;  Position &amp; Costs"
                                           Style="{StaticResource CardTitle}"/>
                                <TextBlock Text="Position Size (lots)"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.PositionSize, TargetNullValue='', StringFormat={}{0:0.##}}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Commission"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.Commission, TargetNullValue='', StringFormat={}{0:0.##}}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Swap"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.Swap, TargetNullValue='', StringFormat={}{0:0.##}}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Fees"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.Fees, TargetNullValue='', StringFormat={}{0:0.##}}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Slippage"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.Slippage, TargetNullValue='', StringFormat={}{0:0.##}}"/>
                            </StackPanel>
                        </Border>

                        <!-- Results -->
                        <Border Grid.Row="2"
                                Grid.Column="2"
                                Style="{StaticResource CardAccent}">
                            <StackPanel>
                                <TextBlock Text="&#x1F4CA;  Results"
                                           Style="{StaticResource CardTitle}"/>
                                <TextBlock Text="Gross PnL"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.GrossPnl, TargetNullValue='', StringFormat={}{0:0.##}}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Net PnL"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.NetPnl, TargetNullValue='', StringFormat={}{0:0.##}}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Risk Amount ($)"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.RiskAmount, TargetNullValue='', StringFormat={}{0:0.##}}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Result R"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.ResultR, TargetNullValue='', StringFormat={}{0:0.####}}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Account Balance Before"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.AccountBalanceBefore, TargetNullValue='', StringFormat={}{0:0.##}}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Account Balance After"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.AccountBalanceAfter, TargetNullValue='', StringFormat={}{0:0.##}}"/>
                            </StackPanel>
                        </Border>

                        <!-- Psychology -->
                        <Border Grid.Row="4"
                                Grid.Column="0"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="&#x1F9E0;  Psychology &amp; PNL"
                                           Style="{StaticResource CardTitle}"/>
                                <TextBlock Text="Emotion Before"
                                           Style="{StaticResource Lbl}"/>
                                <ComboBox ItemsSource="{Binding TradeForm.EmotionOptions}"
                                          SelectedItem="{Binding TradeForm.EmotionBefore}"
                                          Margin="0,0,0,12"/>
                                <TextBlock Text="Emotion After"
                                           Style="{StaticResource Lbl}"/>
                                <ComboBox ItemsSource="{Binding TradeForm.EmotionOptions}"
                                          SelectedItem="{Binding TradeForm.EmotionAfter}"
                                          Margin="0,0,0,12"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="12"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Confidence (1-5)"
                                                   Style="{StaticResource Lbl}"/>
                                        <ComboBox ItemsSource="{Binding TradeForm.ConfidenceLevelOptions}"
                                                  SelectedItem="{Binding TradeForm.ConfidenceLevel}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Rating (1-5)"
                                                   Style="{StaticResource Lbl}"/>
                                        <ComboBox ItemsSource="{Binding TradeForm.RatingOptions}"
                                                  SelectedItem="{Binding TradeForm.Rating}"/>
                                    </StackPanel>
                                </Grid>
                                <Border Height="1"
                                        Background="{StaticResource StrokeB}"
                                        Margin="0,14,0,14"
                                        Opacity="0.5"/>
                                <TextBlock Text="Post-Trade Observation"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.PostTradeObservation, UpdateSourceTrigger=PropertyChanged}"
                                         AcceptsReturn="True"
                                         TextWrapping="Wrap"
                                         Height="60"
                                         VerticalScrollBarVisibility="Auto"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Improvement Commitment"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.ImprovementCommitment, UpdateSourceTrigger=PropertyChanged}"
                                         AcceptsReturn="True"
                                         TextWrapping="Wrap"
                                         Height="60"
                                         VerticalScrollBarVisibility="Auto"/>
                            </StackPanel>
                        </Border>

                        <!-- Context -->
                        <Border Grid.Row="4"
                                Grid.Column="2"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="&#x1F3AF;  Context &amp; Setup"
                                           Style="{StaticResource CardTitle}"/>
                                <TextBlock Text="Setup (e.g. Break &amp; Retest)"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.Setup, UpdateSourceTrigger=PropertyChanged}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Strategy"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.Strategy, UpdateSourceTrigger=PropertyChanged}"
                                         Margin="0,0,0,12"/>
                                <TextBlock Text="Market Condition"
                                           Style="{StaticResource Lbl}"/>
                                <ComboBox ItemsSource="{Binding TradeForm.MarketConditionOptions}"
                                          SelectedItem="{Binding TradeForm.MarketCondition}"
                                          Margin="0,0,0,12"/>
                                <TextBlock Text="Confluence"
                                           Style="{StaticResource Lbl}"/>
                                <ComboBox ItemsSource="{Binding TradeForm.ConfluenceOptions}"
                                          SelectedItem="{Binding TradeForm.Confluence}"
                                          Margin="0,0,0,12"/>
                                <TextBlock Text="Tags (comma separated)"
                                           Style="{StaticResource Lbl}"/>
                                <TextBox Text="{Binding TradeForm.Tags, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>
                        </Border>

                        <!-- Journal -->
                        <Border Grid.Row="6"
                                Grid.Column="0"
                                Grid.ColumnSpan="3"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="&#x1F4DD;  Journal"
                                           Style="{StaticResource CardTitle}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="14"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="14"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Notes"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBox Text="{Binding TradeForm.Notes, UpdateSourceTrigger=PropertyChanged}"
                                                 AcceptsReturn="True"
                                                 TextWrapping="Wrap"
                                                 Height="100"
                                                 VerticalScrollBarVisibility="Auto"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Mistakes"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBox Text="{Binding TradeForm.MistakeNotes, UpdateSourceTrigger=PropertyChanged}"
                                                 AcceptsReturn="True"
                                                 TextWrapping="Wrap"
                                                 Height="100"
                                                 VerticalScrollBarVisibility="Auto"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="4">
                                        <TextBlock Text="Lesson Learned"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBox Text="{Binding TradeForm.LessonLearned, UpdateSourceTrigger=PropertyChanged}"
                                                 AcceptsReturn="True"
                                                 TextWrapping="Wrap"
                                                 Height="100"
                                                 VerticalScrollBarVisibility="Auto"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Timeframe Analysis -->
                        <Border Grid.Row="8"
                                Grid.Column="0"
                                Grid.ColumnSpan="3"
                                Style="{StaticResource CardCyan}">
                            <StackPanel>
                                <TextBlock Text="&#x1F4F8;  Timeframe Analysis"
                                           Style="{StaticResource CardTitle}"/>
                                <TextBlock Text="Auto-generated per configured timeframe. Set up in Settings."
                                           Foreground="{StaticResource MutedB}"
                                           FontSize="11"
                                           Margin="0,-10,0,14"/>
                                <ItemsControl ItemsSource="{Binding TradeForm.TimeframeAnalyses}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Margin="0,0,0,10"
                                                    Padding="14,12"
                                                    CornerRadius="10"
                                                    Background="#080912"
                                                    BorderBrush="{StaticResource StrokeB}"
                                                    BorderThickness="1">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="56"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="14"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Border CornerRadius="8"
                                                            Background="#0C1820"
                                                            Width="44"
                                                            Height="32"
                                                            VerticalAlignment="Top"
                                                            Margin="0,4,0,0">
                                                        <TextBlock Text="{Binding Timeframe}"
                                                                   FontSize="12"
                                                                   FontWeight="Bold"
                                                                   Foreground="{StaticResource CyanB}"
                                                                   HorizontalAlignment="Center"
                                                                   VerticalAlignment="Center"/>
                                                    </Border>
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="Screenshot Path"
                                                                   Style="{StaticResource Lbl}"/>
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <TextBox Text="{Binding ScreenshotPath, UpdateSourceTrigger=PropertyChanged}"/>
                                                            <Button Grid.Column="1"
                                                                    Content="&#x1F4C2;"
                                                                    Margin="6,0,0,0"
                                                                    Padding="10,7"
                                                                    Style="{StaticResource BtnGhost}"
                                                                    Command="{Binding DataContext.TradeForm.BrowseScreenshotCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                    CommandParameter="{Binding}"/>
                                                        </Grid>
                                                    </StackPanel>
                                                    <StackPanel Grid.Column="3">
                                                        <TextBlock Text="Analysis"
                                                                   Style="{StaticResource Lbl}"/>
                                                        <TextBox Text="{Binding Analysis, UpdateSourceTrigger=PropertyChanged}"
                                                                 AcceptsReturn="True"
                                                                 TextWrapping="Wrap"
                                                                 Height="60"
                                                                 VerticalScrollBarVisibility="Auto"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                        <!-- Checklist -->
                        <Border Grid.Row="10"
                                Grid.Column="0"
                                Grid.ColumnSpan="3"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <Grid Margin="0,0,0,14">
                                    <TextBlock Text="&#x2705;  Trade Plan Checklist"
                                               Style="{StaticResource CardTitle}"
                                               Margin="0"/>
                                    <Border HorizontalAlignment="Right"
                                            CornerRadius="8"
                                            Padding="10,5"
                                            Background="#0C1A12">
                                        <TextBlock Text="{Binding TradeForm.ChecklistSummary}"
                                                   FontSize="13"
                                                   FontWeight="Bold"
                                                   Foreground="{StaticResource GreenB}"/>
                                    </Border>
                                </Grid>
                                <ItemsControl ItemsSource="{Binding TradeForm.ChecklistItems}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Margin="0,0,0,4"
                                                    Padding="12,10"
                                                    CornerRadius="8"
                                                    Background="#080912"
                                                    BorderBrush="{StaticResource StrokeB}"
                                                    BorderThickness="1">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="200"/>
                                                    </Grid.ColumnDefinitions>
                                                    <CheckBox IsChecked="{Binding IsChecked}"
                                                              VerticalAlignment="Center"
                                                              Margin="0,0,12,0"/>
                                                    <StackPanel Grid.Column="1"
                                                                VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding RuleName}"
                                                                   FontSize="13"
                                                                   FontWeight="SemiBold"/>
                                                        <Border CornerRadius="4"
                                                                Background="#12131F"
                                                                Padding="6,2"
                                                                HorizontalAlignment="Left"
                                                                Margin="0,3,0,0">
                                                            <TextBlock Text="{Binding Category}"
                                                                       FontSize="9"
                                                                       FontWeight="Bold"
                                                                       Foreground="{StaticResource MutedB}"/>
                                                        </Border>
                                                    </StackPanel>
                                                    <TextBox Grid.Column="2"
                                                             Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}"
                                                             ToolTip="Notes"
                                                             VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                        <!-- Partials & Breakeven -->
                        <Border Grid.Row="12"
                                Grid.Column="0"
                                Grid.ColumnSpan="3"
                                Style="{StaticResource CardAccent}">
                            <StackPanel>
                                <Grid Margin="0,0,0,14">
                                    <TextBlock Text="&#x1F3AF;  Partial Take-Profits &amp; Breakeven"
                                               Style="{StaticResource CardTitle}"
                                               Margin="0"/>
                                    <Button Content="&#x2795; Add Partial"
                                            HorizontalAlignment="Right"
                                            Style="{StaticResource BtnGhost}"
                                            Padding="12,7"
                                            Command="{Binding TradeForm.AddPartialCommand}"/>
                                </Grid>
                                <Border CornerRadius="10"
                                        Background="#0A0810"
                                        Padding="14,12"
                                        Margin="0,0,0,14"
                                        BorderBrush="{StaticResource StrokeB}"
                                        BorderThickness="1">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="20"/>
                                            <ColumnDefinition Width="160"/>
                                            <ColumnDefinition Width="14"/>
                                            <ColumnDefinition Width="160"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <CheckBox Content="  Breakeven Active"
                                                  IsChecked="{Binding TradeForm.IsBreakevenActive}"
                                                  VerticalAlignment="Center"/>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="BE Price"
                                                       Style="{StaticResource Lbl}"/>
                                            <TextBox Text="{Binding TradeForm.BreakevenPrice, TargetNullValue='', StringFormat={}{0:0.######}}"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="4">
                                            <TextBlock Text="BE Date"
                                                       Style="{StaticResource Lbl}"/>
                                            <DatePicker SelectedDate="{Binding TradeForm.BreakevenDate}"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                                <ItemsControl ItemsSource="{Binding TradeForm.Partials}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Margin="0,0,0,6"
                                                    Padding="12,10"
                                                    CornerRadius="10"
                                                    Background="#0A0810"
                                                    BorderBrush="{StaticResource StrokeB}"
                                                    BorderThickness="1">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="32"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="10"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="10"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="10"/>
                                                        <ColumnDefinition Width="70"/>
                                                        <ColumnDefinition Width="10"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="10"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Border CornerRadius="6"
                                                            Background="#1A0C14"
                                                            Width="26"
                                                            Height="26">
                                                        <TextBlock Text="{Binding Index, StringFormat=#{0}}"
                                                                   FontWeight="Bold"
                                                                   FontSize="11"
                                                                   Foreground="{StaticResource AccentB}"
                                                                   HorizontalAlignment="Center"
                                                                   VerticalAlignment="Center"/>
                                                    </Border>
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="Exit Price"
                                                                   Style="{StaticResource Lbl}"/>
                                                        <TextBox Text="{Binding ExitPrice, StringFormat={}{0:0.######}}"/>
                                                    </StackPanel>
                                                    <StackPanel Grid.Column="3">
                                                        <TextBlock Text="Quantity"
                                                                   Style="{StaticResource Lbl}"/>
                                                        <TextBox Text="{Binding Quantity, StringFormat={}{0:0.##}}"/>
                                                    </StackPanel>
                                                    <StackPanel Grid.Column="5">
                                                        <TextBlock Text="PnL"
                                                                   Style="{StaticResource Lbl}"/>
                                                        <TextBox Text="{Binding RealizedPnl, StringFormat={}{0:0.##}}"/>
                                                    </StackPanel>
                                                    <StackPanel Grid.Column="7">
                                                        <TextBlock Text="% Closed"
                                                                   Style="{StaticResource Lbl}"/>
                                                        <TextBox Text="{Binding PercentClosed, StringFormat={}{0:0}}"/>
                                                    </StackPanel>
                                                    <CheckBox Grid.Column="9"
                                                              Content="  &#x2192; BE"
                                                              IsChecked="{Binding MovedToBreakeven}"
                                                              VerticalAlignment="Center"
                                                              ToolTip="Moved SL to breakeven"/>
                                                    <Button Grid.Column="11"
                                                            Content="&#x2715;"
                                                            Style="{StaticResource BtnGhost}"
                                                            Padding="8,5"
                                                            FontSize="11"
                                                            Command="{Binding DataContext.TradeForm.RemovePartialCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </Grid>
                </ScrollViewer>
            </Grid>

            <!-- ══════ PAGE: TRADES ══════ -->
            <Grid Visibility="{Binding CurrentPage, Converter={StaticResource PageVis}, ConverterParameter=Trades}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Border Grid.Row="0"
                        BorderThickness="0,0,0,1"
                        BorderBrush="{StaticResource StrokeB}">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0"
                                             EndPoint="1,0">
                            <GradientStop Color="#0A0B14"
                                          Offset="0"/>
                            <GradientStop Color="#0E0C14"
                                          Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <Grid Margin="28,16">
                        <StackPanel>
                            <TextBlock Text="Trade Log"
                                       FontSize="20"
                                       FontWeight="Bold"
                                       Foreground="White"/>
                            <TextBlock Text="All registered trades · Filter &amp; Analyze"
                                       Foreground="{StaticResource MutedB}"
                                       FontSize="11"
                                       Margin="0,3,0,0"/>
                        </StackPanel>
                        <StackPanel HorizontalAlignment="Right"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center">
                            <Button Style="{StaticResource BtnGhost}"
                                    Content="&#x1F4C4; Export"
                                    Margin="0,0,8,0"
                                    Command="{Binding ExportCsvCommand}"/>
                            <Button Style="{StaticResource BtnGhost}"
                                    Content="&#x270F;&#xFE0F; Edit"
                                    Margin="0,0,8,0"
                                    Command="{Binding EditSelectedCommand}"/>
                            <Button Style="{StaticResource BtnGhost}"
                                    Content="&#x1F5D1; Delete"
                                    Margin="0,0,8,0"
                                    Command="{Binding DeleteSelectedCommand}"/>
                            <Button Style="{StaticResource BtnPrimary}"
                                    Content="&#x21BB; Refresh"
                                    Command="{Binding RefreshCommand}"/>
                        </StackPanel>
                    </Grid>
                </Border>
                <Border Grid.Row="1"
                        Margin="28,14,28,0"
                        Style="{StaticResource Card}"
                        Padding="14">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="10"/>
                            <ColumnDefinition Width="110"/>
                            <ColumnDefinition Width="10"/>
                            <ColumnDefinition Width="110"/>
                            <ColumnDefinition Width="10"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="10"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="8"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Text="{Binding SymbolFilter, UpdateSourceTrigger=PropertyChanged}"
                                 ToolTip="Symbol"/>
                        <ComboBox Grid.Column="2"
                                  SelectedItem="{Binding SideFilter}"
                                  ItemsSource="{Binding SideFilterOptions}"/>
                        <ComboBox Grid.Column="4"
                                  SelectedItem="{Binding StatusFilter}"
                                  ItemsSource="{Binding StatusFilterOptions}"/>
                        <DatePicker Grid.Column="6"
                                    SelectedDate="{Binding FromDate}"/>
                        <DatePicker Grid.Column="8"
                                    SelectedDate="{Binding ToDate}"/>
                        <Button Grid.Column="10"
                                Style="{StaticResource BtnPrimary}"
                                Content="Apply"
                                Command="{Binding ApplyFilterCommand}"/>
                        <Button Grid.Column="12"
                                Style="{StaticResource BtnGhost}"
                                Content="Clear"
                                Command="{Binding ClearFilterCommand}"/>
                    </Grid>
                </Border>
                <Grid Grid.Row="2"
                      Margin="28,14,28,28">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="16"/>
                        <ColumnDefinition Width="340"/>
                    </Grid.ColumnDefinitions>
                    <Border Grid.Column="0"
                            Style="{StaticResource Card}"
                            Padding="0">
                        <DataGrid ItemsSource="{Binding TradesView}"
                                  SelectedItem="{Binding SelectedTrade}"
                                  Margin="8">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="DATE"
                                                    Binding="{Binding OpenedAt, StringFormat=yyyy-MM-dd HH:mm}"
                                                    Width="140"/>
                                <DataGridTextColumn Header="SYMBOL"
                                                    Binding="{Binding Symbol}"
                                                    Width="80"/>
                                <DataGridTextColumn Header="SIDE"
                                                    Binding="{Binding Side}"
                                                    Width="55"/>
                                <DataGridTextColumn Header="STATUS"
                                                    Binding="{Binding Status}"
                                                    Width="65"/>
                                <DataGridTextColumn Header="TF"
                                                    Binding="{Binding Timeframe}"
                                                    Width="50"/>
                                <DataGridTextColumn Header="ENTRY"
                                                    Binding="{Binding EntryPrice}"
                                                    Width="80"/>
                                <DataGridTextColumn Header="EXIT"
                                                    Binding="{Binding ExitPrice}"
                                                    Width="80"/>
                                <DataGridTextColumn Header="NET PNL"
                                                    Binding="{Binding NetPnl, StringFormat={}{0:N2}}"
                                                    Width="80"/>
                                <DataGridTextColumn Header="R"
                                                    Binding="{Binding ResultR, StringFormat={}{0:0.00}}"
                                                    Width="55"/>
                                <DataGridTextColumn Header="SETUP"
                                                    Binding="{Binding Setup}"
                                                    Width="100"/>
                                <DataGridTextColumn Header="RATING"
                                                    Binding="{Binding Rating, Converter={StaticResource Stars}}"
                                                    Width="80"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                    <Border Grid.Column="2"
                            Style="{StaticResource Card}">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel>
                                <TextBlock Text="Trade Details"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           Foreground="White"/>
                                <Border Height="1"
                                        Margin="0,12,0,12">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0.5"
                                                             EndPoint="1,0.5">
                                            <GradientStop Color="#2A0E18"
                                                          Offset="0"/>
                                            <GradientStop Color="#1E2035"
                                                          Offset="0.5"/>
                                            <GradientStop Color="#0A1520"
                                                          Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                </Border>
                                <TextBlock Text="SYMBOL"
                                           Style="{StaticResource Lbl}"/>
                                <TextBlock Text="{Binding SelectedTrade.Symbol}"
                                           FontSize="20"
                                           FontWeight="Bold"
                                           Foreground="{StaticResource CyanB}"
                                           Margin="0,2,0,12"/>
                                <Grid Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="SIDE"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBlock Text="{Binding SelectedTrade.Side}"
                                                   FontWeight="SemiBold"
                                                   Foreground="{Binding SelectedTrade.Side, Converter={StaticResource SideBrush}}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="STATUS"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBlock Text="{Binding SelectedTrade.Status}"
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Grid>
                                <Grid Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="ENTRY"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBlock Text="{Binding SelectedTrade.EntryPrice}"
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="EXIT"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBlock Text="{Binding SelectedTrade.ExitPrice}"
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Grid>
                                <Grid Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="SL"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBlock Text="{Binding SelectedTrade.StopLoss}"
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="TP"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBlock Text="{Binding SelectedTrade.TakeProfit}"
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Grid>
                                <TextBlock Text="NET PNL"
                                           Style="{StaticResource Lbl}"/>
                                <TextBlock Text="{Binding SelectedTrade.NetPnl, StringFormat=${}{0:N2}}"
                                           FontSize="26"
                                           FontWeight="Bold"
                                           Margin="0,2,0,12"
                                           Foreground="{Binding SelectedTrade.NetPnl, Converter={StaticResource PnlBrush}}"/>
                                <Grid Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="RESULT R"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBlock Text="{Binding SelectedTrade.ResultR, StringFormat={}{0:0.00}R}"
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="R:R RATIO"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBlock Text="{Binding SelectedTrade.RiskRewardRatio, StringFormat=1:{0:0.0}}"
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Grid>
                                <Border Height="1"
                                        Background="{StaticResource StrokeB}"
                                        Margin="0,4,0,14"
                                        Opacity="0.5"/>
                                <TextBlock Text="SETUP"
                                           Style="{StaticResource Lbl}"/>
                                <TextBlock Text="{Binding SelectedTrade.Setup}"
                                           Margin="0,2,0,10"
                                           FontWeight="SemiBold"/>
                                <TextBlock Text="STRATEGY"
                                           Style="{StaticResource Lbl}"/>
                                <TextBlock Text="{Binding SelectedTrade.Strategy}"
                                           Margin="0,2,0,10"/>
                                <TextBlock Text="SESSION"
                                           Style="{StaticResource Lbl}"/>
                                <TextBlock Text="{Binding SelectedTrade.Session}"
                                           Margin="0,2,0,10"/>
                                <TextBlock Text="CONFLUENCE"
                                           Style="{StaticResource Lbl}"/>
                                <TextBlock Text="{Binding SelectedTrade.Confluence}"
                                           Margin="0,2,0,10"/>
                                <Border Height="1"
                                        Background="{StaticResource StrokeB}"
                                        Margin="0,4,0,14"
                                        Opacity="0.5"/>
                                <TextBlock Text="EMOTION"
                                           Style="{StaticResource Lbl}"/>
                                <TextBlock Margin="0,2,0,10">
                                    <Run Text="{Binding SelectedTrade.EmotionBefore, Mode=OneWay}"/>
                                    <Run Text="  →  "
                                         Foreground="{StaticResource MutedB}"/>
                                    <Run Text="{Binding SelectedTrade.EmotionAfter, Mode=OneWay}"/>
                                </TextBlock>
                                <TextBlock Text="NOTES"
                                           Style="{StaticResource Lbl}"/>
                                <TextBlock Text="{Binding SelectedTrade.Notes}"
                                           TextWrapping="Wrap"
                                           Opacity="0.85"
                                           Margin="0,2,0,10"/>
                                <TextBlock Text="MISTAKES"
                                           Style="{StaticResource Lbl}"/>
                                <TextBlock Text="{Binding SelectedTrade.MistakeNotes}"
                                           TextWrapping="Wrap"
                                           Foreground="{StaticResource AccentB}"
                                           Opacity="0.9"
                                           Margin="0,2,0,10"/>
                                <TextBlock Text="LESSON"
                                           Style="{StaticResource Lbl}"/>
                                <TextBlock Text="{Binding SelectedTrade.LessonLearned}"
                                           TextWrapping="Wrap"
                                           Foreground="{StaticResource GreenB}"
                                           Opacity="0.9"/>
                            </StackPanel>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </Grid>

            <!-- ══════ PAGE: DASHBOARD ══════ -->
            <ScrollViewer VerticalScrollBarVisibility="Auto"
                          Visibility="{Binding CurrentPage, Converter={StaticResource PageVis}, ConverterParameter=Dashboard}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <Border Grid.Row="0"
                            BorderThickness="0,0,0,1"
                            BorderBrush="{StaticResource StrokeB}">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0"
                                                 EndPoint="1,0">
                                <GradientStop Color="#0A0B14"
                                              Offset="0"/>
                                <GradientStop Color="#0C0A16"
                                              Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <Grid Margin="28,16">
                            <StackPanel>
                                <TextBlock Text="Dashboard"
                                           FontSize="20"
                                           FontWeight="Bold"
                                           Foreground="White"/>
                                <TextBlock Text="Portfolio Overview · Real-time Statistics"
                                           Foreground="{StaticResource MutedB}"
                                           FontSize="11"
                                           Margin="0,3,0,0"/>
                            </StackPanel>
                            <Button Style="{StaticResource BtnPrimary}"
                                    Content="&#x21BB; Refresh"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    Command="{Binding RefreshCommand}"/>
                        </Grid>
                    </Border>

                    <!-- KPI Row 1 -->
                    <Grid Grid.Row="1"
                          Margin="28,20,28,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="14"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="14"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="14"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Style="{StaticResource CardAccent}">
                            <StackPanel>
                                <TextBlock Text="TOTAL TRADES"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Text="{Binding Stats.TotalTrades}"
                                           Style="{StaticResource KpiValue}"/>
                                <TextBlock Style="{StaticResource KpiSub}">
                                    <Run Text="{Binding Stats.OpenTrades, Mode=OneWay}"/>
                                    <Run Text=" open · "/>
                                    <Run Text="{Binding Stats.ClosedTrades, Mode=OneWay}"/>
                                    <Run Text=" closed"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="2"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="WIN RATE"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Style="{StaticResource KpiValue}"
                                           Foreground="{StaticResource GreenB}">
                                    <Run Text="{Binding Stats.WinRate, StringFormat={}{0:0.0}%, Mode=OneWay}"/>
                                </TextBlock>
                                <TextBlock Style="{StaticResource KpiSub}">
                                    <Run Text="{Binding Stats.WinCount, Mode=OneWay}"/>
                                    <Run Text="W · "/>
                                    <Run Text="{Binding Stats.LossCount, Mode=OneWay}"/>
                                    <Run Text="L · "/>
                                    <Run Text="{Binding Stats.BreakEvenCount, Mode=OneWay}"/>
                                    <Run Text="BE"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="4"
                                Style="{StaticResource CardCyan}">
                            <StackPanel>
                                <TextBlock Text="PROFIT FACTOR"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Text="{Binding Stats.ProfitFactor, StringFormat={}{0:0.00}}"
                                           Style="{StaticResource KpiValue}"
                                           Foreground="{StaticResource CyanB}"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="6"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="EXPECTANCY ($)"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Text="{Binding Stats.Expectancy, StringFormat={}{0:N2}}"
                                           Style="{StaticResource KpiValue}"
                                           Foreground="{Binding Stats.Expectancy, Converter={StaticResource PnlBrush}}"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- KPI Row 2 -->
                    <Grid Grid.Row="2"
                          Margin="28,14,28,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="14"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="14"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="14"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Style="{StaticResource CardAccent}">
                            <StackPanel>
                                <TextBlock Text="NET PNL"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Text="{Binding Stats.NetPnl, StringFormat={}{0:N2}}"
                                           Style="{StaticResource KpiValue}"
                                           Foreground="{Binding Stats.NetPnl, Converter={StaticResource PnlBrush}}"/>
                                <TextBlock Style="{StaticResource KpiSub}">
                                    <Run Text="Fees: "/>
                                    <Run Text="{Binding Stats.TotalFees, StringFormat={}{0:N2}, Mode=OneWay}"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="2"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="AVG R"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Text="{Binding Stats.AverageR, StringFormat={}{0:0.00}R}"
                                           Style="{StaticResource KpiValue}"
                                           Foreground="{Binding Stats.AverageR, Converter={StaticResource PnlBrush}}"/>
                                <TextBlock Style="{StaticResource KpiSub}">
                                    <Run Text="Best: "/>
                                    <Run Text="{Binding Stats.BestR, StringFormat={}{0:0.00}R, Mode=OneWay}"/>
                                    <Run Text=" · Worst: "/>
                                    <Run Text="{Binding Stats.WorstR, StringFormat={}{0:0.00}R, Mode=OneWay}"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="4"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="MAX DRAWDOWN"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Text="{Binding Stats.MaxDrawdown, StringFormat=${}{0:N2}}"
                                           Style="{StaticResource KpiValue}"
                                           Foreground="{StaticResource AccentB}"/>
                                <TextBlock Style="{StaticResource KpiSub}">
                                    <Run Text="{Binding Stats.MaxDrawdownPercent, StringFormat={}{0:0.0}%, Mode=OneWay}"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="6"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="MAX CONS. LOSSES"
                                           Style="{StaticResource KpiLabel}"/>
                                <TextBlock Text="{Binding Stats.MaxConsecutiveLosses}"
                                           Style="{StaticResource KpiValue}"
                                           Foreground="{StaticResource AccentB}"/>
                                <TextBlock Style="{StaticResource KpiSub}">
                                    <Run Text="Max Wins: "/>
                                    <Run Text="{Binding Stats.MaxConsecutiveWins, Mode=OneWay}"/>
                                    <Run Text=" · Streak: "/>
                                    <Run Text="{Binding Stats.CurrentStreak, Mode=OneWay}"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Summary -->
                    <Grid Grid.Row="3"
                          Margin="28,18,28,28">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="14"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="Advanced Metrics"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           Foreground="White"
                                           Margin="0,0,0,16"/>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Average Win"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.AverageWin, StringFormat=${}{0:N2}}"
                                               Foreground="{StaticResource GreenB}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Average Loss"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.AverageLoss, StringFormat=-${}{0:N2}}"
                                               Foreground="{StaticResource AccentB}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Largest Win"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.LargestWin, StringFormat=${}{0:N2}}"
                                               Foreground="{StaticResource GreenB}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Largest Loss"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.LargestLoss, StringFormat=${}{0:N2}}"
                                               Foreground="{StaticResource AccentB}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Border Height="1"
                                        Background="{StaticResource StrokeB}"
                                        Margin="0,6,0,10"
                                        Opacity="0.5"/>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Gross PnL"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.GrossPnl, StringFormat=${}{0:N2}}"
                                               FontWeight="SemiBold"
                                               Foreground="{Binding Stats.GrossPnl, Converter={StaticResource PnlBrush}}"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Total Fees / Costs"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.TotalFees, StringFormat=${}{0:N2}}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Expectancy (R)"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.ExpectancyR, StringFormat={}{0:0.0000}R}"
                                               FontWeight="SemiBold"
                                               Foreground="{Binding Stats.ExpectancyR, Converter={StaticResource PnlBrush}}"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                        <Border Grid.Column="2"
                                Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="Distribution &amp; Time"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           Foreground="White"
                                           Margin="0,0,0,16"/>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Long Trades"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               FontWeight="SemiBold">
                                        <Run Text="{Binding Stats.LongCount, Mode=OneWay}"/>
                                        <Run Text=" (WR: "/>
                                        <Run Text="{Binding Stats.LongWinRate, StringFormat={}{0:0.0}%, Mode=OneWay}"/>
                                        <Run Text=")"/>
                                    </TextBlock>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Short Trades"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               FontWeight="SemiBold">
                                        <Run Text="{Binding Stats.ShortCount, Mode=OneWay}"/>
                                        <Run Text=" (WR: "/>
                                        <Run Text="{Binding Stats.ShortWinRate, StringFormat={}{0:0.0}%, Mode=OneWay}"/>
                                        <Run Text=")"/>
                                    </TextBlock>
                                </Grid>
                                <Border Height="1"
                                        Background="{StaticResource StrokeB}"
                                        Margin="0,6,0,10"
                                        Opacity="0.5"/>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Avg Hold Time"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding AvgHoldTimeText}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Longest Hold"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding LongestHoldText}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Shortest Hold"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding ShortestHoldText}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Border Height="1"
                                        Background="{StaticResource StrokeB}"
                                        Margin="0,6,0,10"
                                        Opacity="0.5"/>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Win Rate (Long)"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.LongWinRate, StringFormat={}{0:0.0}%}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                                <Grid Style="{StaticResource MRow}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Win Rate (Short)"
                                               Style="{StaticResource Lbl}"
                                               Margin="0"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Stats.ShortWinRate, StringFormat={}{0:0.0}%}"
                                               FontWeight="SemiBold"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Grid>
            </ScrollViewer>

            <!-- ══════ PAGE: SETTINGS ══════ -->
            <Grid Visibility="{Binding CurrentPage, Converter={StaticResource PageVis}, ConverterParameter=Settings}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel DataContext="{Binding Settings}"
                                Margin="28,20,28,28"
                                MaxWidth="920"
                                HorizontalAlignment="Left">
                        <TextBlock Text="&#x2699;&#xFE0F;  Settings"
                                   FontSize="22"
                                   FontWeight="Bold"
                                   Foreground="White"/>
                        <TextBlock Text="{Binding StatusText}"
                                   Foreground="{StaticResource MutedB}"
                                   FontSize="12"
                                   Margin="0,4,0,24"/>

                        <!-- Timeframes -->
                        <Border Style="{StaticResource CardCyan}"
                                Margin="0,0,0,18">
                            <StackPanel>
                                <TextBlock Text="&#x1F4CA;  Timeframes"
                                           Style="{StaticResource CardTitle}"/>
                                <TextBlock Text="Define the timeframes you analyse per trade. The form auto-generates fields for each."
                                           Foreground="{StaticResource MutedB}"
                                           FontSize="11"
                                           Margin="0,-10,0,14"/>
                                <Grid Margin="0,0,0,14">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding NewTimeframe, UpdateSourceTrigger=PropertyChanged}"
                                             ToolTip="e.g. 1H, 4H, 1D"/>
                                    <Button Grid.Column="1"
                                            Content="&#x2795; Add"
                                            Margin="10,0,0,0"
                                            Padding="16,9"
                                            Style="{StaticResource BtnGhost}"
                                            Command="{Binding AddTimeframeCommand}"/>
                                </Grid>
                                <ListBox ItemsSource="{Binding Timeframes}"
                                         SelectedItem="{Binding SelectedTimeframe}"
                                         Background="Transparent"
                                         Foreground="White"
                                         BorderThickness="0"
                                         MinHeight="40"
                                         MaxHeight="200">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border CornerRadius="6"
                                                    Background="#0C1820"
                                                    Padding="10,6"
                                                    Margin="0,2">
                                                <TextBlock Text="{Binding}"
                                                           FontSize="14"
                                                           FontWeight="Bold"
                                                           Foreground="{StaticResource CyanB}"/>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,10,0,0">
                                    <Button Content="&#x2B06; Up"
                                            Style="{StaticResource BtnGhost}"
                                            Padding="12,7"
                                            Margin="0,0,6,0"
                                            Command="{Binding MoveTimeframeUpCommand}"/>
                                    <Button Content="&#x2B07; Down"
                                            Style="{StaticResource BtnGhost}"
                                            Padding="12,7"
                                            Margin="0,0,6,0"
                                            Command="{Binding MoveTimeframeDownCommand}"/>
                                    <Button Content="&#x1F5D1; Remove"
                                            Style="{StaticResource BtnGhost}"
                                            Padding="12,7"
                                            Command="{Binding RemoveTimeframeCommand}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Checklist -->
                        <Border Style="{StaticResource Card}"
                                Margin="0,0,0,18">
                            <StackPanel>
                                <TextBlock Text="&#x2705;  Checklist Rules"
                                           Style="{StaticResource CardTitle}"/>
                                <TextBlock Text="Define your trade-plan checklist. Active rules appear during trade registration."
                                           Foreground="{StaticResource MutedB}"
                                           FontSize="11"
                                           Margin="0,-10,0,14"/>
                                <Border CornerRadius="10"
                                        Padding="16"
                                        Margin="0,0,0,14"
                                        Background="#0A0B14"
                                        BorderBrush="{StaticResource StrokeB}"
                                        BorderThickness="1">
                                    <StackPanel>
                                        <TextBlock Text="NEW RULE"
                                                   FontSize="10"
                                                   FontWeight="Bold"
                                                   Foreground="{StaticResource AccentB}"
                                                   Margin="0,0,0,10"/>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="12"/>
                                                <ColumnDefinition Width="150"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel>
                                                <TextBlock Text="Rule Name"
                                                           Style="{StaticResource Lbl}"/>
                                                <TextBox Text="{Binding NewRuleName, UpdateSourceTrigger=PropertyChanged}"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2">
                                                <TextBlock Text="Category"
                                                           Style="{StaticResource Lbl}"/>
                                                <ComboBox Text="{Binding NewRuleCategory, UpdateSourceTrigger=PropertyChanged}"
                                                          ItemsSource="{Binding CategorySuggestions}"
                                                          IsEditable="True"/>
                                            </StackPanel>
                                        </Grid>
                                        <TextBlock Text="Description (optional)"
                                                   Style="{StaticResource Lbl}"
                                                   Margin="0,10,0,0"/>
                                        <TextBox Text="{Binding NewRuleDescription, UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,10"/>
                                        <Button Content="&#x2795; Add Rule"
                                                HorizontalAlignment="Left"
                                                Padding="16,9"
                                                Style="{StaticResource BtnPrimary}"
                                                Command="{Binding AddRuleCommand}"/>
                                    </StackPanel>
                                </Border>
                                <ListBox ItemsSource="{Binding ChecklistRules}"
                                         SelectedItem="{Binding SelectedRule}"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         MinHeight="40"
                                         MaxHeight="280">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border CornerRadius="8"
                                                    Background="#080912"
                                                    Padding="12,10"
                                                    Margin="0,2"
                                                    BorderBrush="{StaticResource StrokeB}"
                                                    BorderThickness="1">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Ellipse Width="8"
                                                             Height="8"
                                                             Margin="0,0,12,0"
                                                             VerticalAlignment="Center">
                                                        <Ellipse.Style>
                                                            <Style TargetType="Ellipse">
                                                                <Setter Property="Fill"
                                                                        Value="{StaticResource GreenB}"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsActive}"
                                                                                 Value="False">
                                                                        <Setter Property="Fill"
                                                                                Value="{StaticResource MutedB}"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Ellipse.Style>
                                                    </Ellipse>
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="{Binding Name}"
                                                                   FontSize="13"
                                                                   FontWeight="SemiBold"
                                                                   Foreground="White"/>
                                                        <StackPanel Orientation="Horizontal"
                                                                    Margin="0,3,0,0">
                                                            <Border CornerRadius="4"
                                                                    Background="#12131F"
                                                                    Padding="6,2"
                                                                    Margin="0,0,6,0">
                                                                <TextBlock Text="{Binding Category}"
                                                                           FontSize="9"
                                                                           FontWeight="Bold"
                                                                           Foreground="{StaticResource MutedB}"/>
                                                            </Border>
                                                            <TextBlock Text="{Binding Description}"
                                                                       FontSize="10"
                                                                       Foreground="{StaticResource MutedB}"
                                                                       VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                    <TextBlock Grid.Column="2"
                                                               FontSize="10"
                                                               VerticalAlignment="Center"
                                                               Foreground="{StaticResource MutedB}">
                                                        <Run Text="#"/>
                                                        <Run Text="{Binding SortOrder, Mode=OneWay}"/>
                                                    </TextBlock>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                                <Border CornerRadius="10"
                                        Padding="16"
                                        Margin="0,14,0,0"
                                        Background="#0A0B14"
                                        BorderBrush="{StaticResource StrokeB}"
                                        BorderThickness="1"
                                        Visibility="{Binding SelectedRule, Converter={StaticResource NullVis}}">
                                    <StackPanel>
                                        <TextBlock Text="EDIT SELECTED"
                                                   FontSize="10"
                                                   FontWeight="Bold"
                                                   Foreground="{StaticResource AmberB}"
                                                   Margin="0,0,0,10"/>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="12"/>
                                                <ColumnDefinition Width="150"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel>
                                                <TextBlock Text="Rule Name"
                                                           Style="{StaticResource Lbl}"/>
                                                <TextBox Text="{Binding EditRuleName, UpdateSourceTrigger=PropertyChanged}"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2">
                                                <TextBlock Text="Category"
                                                           Style="{StaticResource Lbl}"/>
                                                <ComboBox Text="{Binding EditRuleCategory, UpdateSourceTrigger=PropertyChanged}"
                                                          ItemsSource="{Binding CategorySuggestions}"
                                                          IsEditable="True"/>
                                            </StackPanel>
                                        </Grid>
                                        <TextBlock Text="Description"
                                                   Style="{StaticResource Lbl}"
                                                   Margin="0,10,0,0"/>
                                        <TextBox Text="{Binding EditRuleDescription, UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,12"/>
                                        <StackPanel Orientation="Horizontal">
                                            <CheckBox Content="  Active"
                                                      IsChecked="{Binding EditRuleIsActive}"
                                                      VerticalAlignment="Center"
                                                      Margin="0,0,16,0"/>
                                            <Button Content="&#x1F4BE; Save"
                                                    Style="{StaticResource BtnPrimary}"
                                                    Padding="14,8"
                                                    Margin="0,0,6,0"
                                                    Command="{Binding UpdateRuleCommand}"/>
                                            <Button Content="&#x1F500; Toggle"
                                                    Style="{StaticResource BtnGhost}"
                                                    Padding="12,8"
                                                    Margin="0,0,6,0"
                                                    Command="{Binding ToggleRuleCommand}"/>
                                            <Button Content="&#x1F5D1; Delete"
                                                    Style="{StaticResource BtnGhost}"
                                                    Padding="12,8"
                                                    Command="{Binding DeleteRuleCommand}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>

                        <!-- Preferences -->
                        <Border Style="{StaticResource Card}"
                                Margin="0,0,0,18">
                            <StackPanel>
                                <TextBlock Text="&#x1F4B0;  Preferences"
                                           Style="{StaticResource CardTitle}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="14"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="14"/>
                                        <ColumnDefinition Width="120"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Default Risk %"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBox Text="{Binding DefaultRiskPercent, StringFormat={}{0:0.##}}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Account Balance"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBox Text="{Binding DefaultAccountBalance, TargetNullValue='', StringFormat={}{0:0.##}}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="4">
                                        <TextBlock Text="Currency"
                                                   Style="{StaticResource Lbl}"/>
                                        <TextBox Text="{Binding BaseCurrency, UpdateSourceTrigger=PropertyChanged}"/>
                                    </StackPanel>
                                </Grid>
                                <Button Content="&#x1F4BE; Save Preferences"
                                        HorizontalAlignment="Left"
                                        Margin="0,16,0,0"
                                        Padding="18,9"
                                        Style="{StaticResource BtnPrimary}"
                                        Command="{Binding SavePreferencesCommand}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>

        </Grid>
    </Grid>
</Window>
